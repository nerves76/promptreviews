!function(){"use strict";const e={};function t(){const e="promptreviews-single-widget-styles";if(document.getElementById(e))return;const t=document.createElement("link");let n;t.id=e,t.rel="stylesheet",t.type="text/css";const i=document.currentScript?document.currentScript.src:null;n=i?new URL("single-widget.css",i).href:"/widgets/single/single-widget.css",t.href=`${n}?v=${(new Date).getTime()}`,console.log("Attempting to load CSS from:",t.href),document.head.appendChild(t)}function n(e,t){const n=(e,n)=>t[e]||n;e.style.setProperty("--pr-card-bg",n("bgColor","#ffffff")),e.style.setProperty("--pr-text-color",n("textColor","#22223b")),e.style.setProperty("--pr-accent-color",n("accentColor","#4f46e5")),e.style.setProperty("--pr-name-text-color",n("nameTextColor","#1a237e")),e.style.setProperty("--pr-role-text-color",n("roleTextColor","#6b7280")),e.style.setProperty("--pr-card-border-width",`${t.borderWidth||2}px`),e.style.setProperty("--pr-card-border-color",n("borderColor","#cccccc")),e.style.setProperty("--pr-card-radius",`${t.borderRadius||16}px`),e.style.setProperty("--pr-card-opacity",void 0!==t.bgOpacity?t.bgOpacity:1),e.style.setProperty("--pr-font-family",t.font||"Inter, sans-serif"),e.style.setProperty("--pr-line-spacing",t.lineSpacing||1.4);const i=t.shadowIntensity||.2,o=t.shadow?`0 4px 6px -1px rgba(0, 0, 0, ${i})`:"none";e.style.setProperty("--pr-card-shadow",o),e.style.setProperty("--pr-attribution-font-size",`${t.attributionFontSize||15}px`)}function i(t,n,i){console.log(`üöÄ single_initCarousel: Initializing for widgetId: "${t}"`);const r=document.getElementById(t);if(!r)return void console.error(`‚ùå single_initCarousel: FAILED to find element with ID: "${t}". The widget cannot be initialized.`);console.log("‚úÖ single_initCarousel: Found widgetElement:",r),function(t,n,i){e[t]={currentIndex:0,totalItems:n.length,itemsPerView:1,autoAdvance:i.autoAdvance||!1,slideshowSpeed:i.slideshowSpeed||4,autoAdvanceInterval:null}}(t,n,i);const s=e[t];if(!s)return void console.error(`‚ùå single_initCarousel: FAILED to initialize state for widgetId: "${t}"`);r.querySelector(".pr-single-carousel-track");const l=r.querySelector(".pr-single-prev-btn"),a=r.querySelector(".pr-single-next-btn");l&&l.addEventListener("click",()=>{s.currentIndex>0&&(s.currentIndex--,o(t))}),a&&a.addEventListener("click",()=>{s.currentIndex<s.totalItems-1&&(s.currentIndex++,o(t))}),s.autoAdvance&&s.totalItems>1&&(s.autoAdvanceInterval=setInterval(()=>{s.currentIndex<s.totalItems-1?s.currentIndex++:s.currentIndex=0,o(t)},1e3*s.slideshowSpeed)),o(t)}function o(t){const n=e[t];if(!n)return;const i=document.getElementById(t);if(!i)return;const r=i.querySelector(".pr-single-carousel-track");if(!r)return;n.itemsPerView=1;const s=i.querySelector(".pr-single-carousel-item");if(!s)return;const l=window.getComputedStyle(r).gap,a=parseFloat(l)||0,c=s.offsetWidth+a,d=-n.currentIndex*c;r.style.transform=`translateX(${d}px)`,function(t){const n=e[t];if(!n)return;const i=document.getElementById(t);if(!i)return;const r=i.querySelector(".pr-single-dots-container");if(!r)return;r.innerHTML="";for(let e=0;e<n.totalItems;e++){const i=document.createElement("button");i.className="pr-single-dot "+(e===n.currentIndex?"active":""),i.addEventListener("click",()=>{n.currentIndex=e,o(t)}),r.appendChild(i)}}(t),function(t){const n=e[t];if(!n)return;const i=document.getElementById(t);if(!i)return;const o=i.querySelector(".pr-single-prev-btn"),r=i.querySelector(".pr-single-next-btn");o&&(o.style.opacity=0===n.currentIndex?"0.5":"1",o.disabled=0===n.currentIndex);r&&(r.style.opacity=n.currentIndex===n.totalItems-1?"0.5":"1",r.disabled=n.currentIndex===n.totalItems-1)}(t)}function r(e,t){const n=e.review_content,i=t.showRelativeDate?function(e){if(!e)return"";const t=new Date(e),n=new Date,i=Math.abs(n-t),o=Math.ceil(i/864e5);return 1===o?"1 day ago":o<7?`${o} days ago`:o<30?`${Math.floor(o/7)} weeks ago`:o<365?`${Math.floor(o/30)} months ago`:`${Math.floor(o/365)} years ago`}(e.created_at):new Date(e.created_at).toLocaleDateString();return`\n      <div class="pr-single-review-card">\n        <div class="pr-single-stars-row">${function(e){let t="";for(let n=1;n<=5;n++)t+=`<span class="pr-single-star ${n<=e?"filled":""}">&#9733;</span>`;return t}(e.star_rating)}</div>\n        <div class="pr-single-review-content">\n          <p class="pr-single-review-text">${n}</p>\n        </div>\n        <div class="pr-single-reviewer-details">\n          <div class="pr-single-reviewer-name">${e.first_name||""} ${e.last_name||""}</div>\n          ${e.reviewer_role?`<div class="pr-single-reviewer-role">${e.reviewer_role}</div>`:""}\n          <div class="pr-single-review-date">${i}</div>\n        </div>\n      </div>\n    `}function s(e,t,n,i){const o=t.map(e=>`<div class="pr-single-carousel-item">${r(e,n)}</div>`).join(""),s=`\n      <div class="pr-single-submit-review-container">\n        <a href="/r/${i}?source=widget" target="_blank" class="pr-single-submit-btn">\n          Submit a Review\n        </a>\n      </div>\n    `,l=function(e,t){if(!e||0===e.length)return"";const n=(e.reduce((e,t)=>e+(t.star_rating||0),0)/e.length).toFixed(1),i=e.length,o={"@context":"https://schema.org","@type":"Product",name:t||document.title||"Business",aggregateRating:{"@type":"AggregateRating",ratingValue:n,bestRating:"5",worstRating:"1",ratingCount:i,reviewCount:i},review:e.slice(0,5).map(e=>({"@type":"Review",reviewRating:{"@type":"Rating",ratingValue:e.star_rating||5,bestRating:"5",worstRating:"1"},author:{"@type":"Person",name:`${e.first_name||""} ${e.last_name||""}`.trim()||"Anonymous"},datePublished:e.created_at,reviewBody:e.review_content}))};return`<script type="application/ld+json">${JSON.stringify(o)}<\/script>`}(t,null);return`\n      ${l}\n      <div class="pr-single-carousel-container">\n        <div class="pr-single-carousel-track">\n          ${o}\n        </div>\n      </div>\n      ${t.length>1?'\n      <div class="pr-single-carousel-controls">\n        <button class="pr-single-prev-btn" title="Previous review"></button>\n        <div class="pr-single-dots-container"></div>\n        <button class="pr-single-next-btn" title="Next review"></button>\n      </div>\n    ':""}\n      ${n.showSubmitReviewButton?s:""}\n    `}async function l(){if(window.location.pathname.includes("/dashboard"))return void console.log("üîÑ SingleWidget: Dashboard context detected, skipping auto-initialization");console.log("üöÄ AUTO INIT STARTED - Single Widget"),console.log("üîç Auto-initialization: Looking for widget containers...");const e=document.querySelectorAll("*"),o=Array.from(e).filter(e=>Object.keys(e.dataset).length>0);console.log("üîç All elements with data attributes:",o.length),o.forEach(e=>{console.log("üîç Element:",e.tagName,"data attributes:",Object.keys(e.dataset))});const r=document.querySelectorAll("[data-widget-id]"),l=Array.from(r).filter(e=>"single"===e.dataset.widgetType);if(console.log("üîç Auto-initialization: Found single widget containers:",l.length),l.length>0){console.log("üîç Auto-initialization: Processing containers..."),t();for(const e of l){const t=e.dataset.widgetId,o=e.getAttribute("data-business-slug");console.log("üîç Auto-initialization: Processing widget:",t,"business slug:",o);try{const o="app.promptreviews.app"===window.location.hostname?`/api/widgets/${t}`:`https://app.promptreviews.app/api/widgets/${t}`,r=await fetch(o);if(!r.ok)throw new Error(`Failed to fetch widget data: ${r.statusText}`);const{reviews:l,design:c,businessSlug:d}=await r.json();console.log("üîç Auto-initialization: Fetched data for widget:",t,"reviews:",l?.length),l&&l.length>0?(e.id=`pr-single-widget-${t}`,a(c.font),n(e,c),e.innerHTML=s(e.id,l,c,d),e.classList.add("pr-widget-container","pr-single-widget"),i(e.id,l,c),console.log("üîç Auto-initialization: Successfully initialized widget:",t)):(e.innerHTML='\n          <div style="display: flex; align-items: center; justify-content: center; min-height: 200px; color: white; font-size: 18px;">\n            <div style="text-align: center;">\n              <div style="display: flex; align-items: center; justify-content: center; gap: 8px; margin-bottom: 8px;">\n                <svg style="width: 24px; height: 24px;" fill="currentColor" viewBox="0 0 20 20">\n                  <path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd" />\n                </svg>\n                <span>Add reviews to your widget</span>\n              </div>\n              <p style="font-size: 14px; opacity: 0.8;">Click talk bubble icon to add and manage reviews.</p>\n            </div>\n          </div>\n        ',console.log("üîç Auto-initialization: No reviews for widget:",t))}catch(t){console.error("Error initializing PromptReviews Single widget:",t),e.innerHTML="<p>Error loading reviews.</p>"}}}else console.log("üîç Auto-initialization: No single widget containers found."),console.log("üîç Available data attributes on page:",o.map(e=>Object.keys(e.dataset)).flat())}function a(e){e&&"Inter"!==e||(e="Inter");const t=`google-font-${e.replace(/\s+/g,"-")}`;if(document.getElementById(t))return;const n=document.createElement("link");n.id=t,n.href=`https://fonts.googleapis.com/css2?family=${e.replace(/\s+/g,"+")}:wght@400;600;700&display=swap`,n.rel="stylesheet",document.head.appendChild(n)}window.PromptReviewsSingle=window.PromptReviewsSingle||{},window.PromptReviewsSingle.initializeWidget||(window.PromptReviewsSingle.initializeWidget=function(e,o,r,l){if(console.log("--- WIDGET INITIALIZATION - BUILD VERSION 5.0 ---"),console.log("üöÄ SingleWidget: Initializing widget",{containerId:e,reviewsCount:o?.length,design:r}),!o||0===o.length)return void console.warn("‚ö†Ô∏è SingleWidget: No reviews provided");const c=document.getElementById(e);if(!c)return void console.error("‚ùå SingleWidget: Widget container not found:",e);t(),a(r.font),n(c,r);const d=s(e,o,r,l);c.innerHTML=d,c.classList.add("pr-widget-container","pr-single-widget"),i(e,o,r),console.log("‚úÖ SingleWidget: Widget initialized successfully")}),window.PromptReviewsSingle.renderSingleWidget=function(e,t,n,i){window.PromptReviewsSingle.initializeWidget(e,t,n,i)},"loading"===document.readyState?document.addEventListener("DOMContentLoaded",l):l(),console.log("‚úÖ SingleWidget: Widget script loaded successfully")}();