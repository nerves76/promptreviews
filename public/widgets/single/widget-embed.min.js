!function(){"use strict";function e(e,t){if(!e||0===e.length)return"";const n=(e.reduce((e,t)=>e+(t.star_rating||0),0)/e.length).toFixed(1),i=e.length,r={"@context":"https://schema.org","@type":"Product",name:t||document.title||"Business",aggregateRating:{"@type":"AggregateRating",ratingValue:n,bestRating:"5",worstRating:"1",ratingCount:i,reviewCount:i},review:e.slice(0,5).map(e=>({"@type":"Review",reviewRating:{"@type":"Rating",ratingValue:e.star_rating||5,bestRating:"5",worstRating:"1"},author:{"@type":"Person",name:`${e.first_name||""} ${e.last_name||""}`.trim()||"Anonymous"},datePublished:e.created_at,reviewBody:e.review_content}))};return`<script type="application/ld+json">${JSON.stringify(r)}<\/script>`}function t(e,t){if(!e)return"";const n=new Date(e),i=new Date,r=Math.round((i-n)/1e3),o=Math.round(r/60),s=Math.round(o/60),a=Math.round(s/24),l=Math.round(a/7),d=Math.round(a/30.44),c=Math.round(a/365.25);return t?r<60?`${r} second${1!==r?"s":""} ago`:o<60?`${o} minute${1!==o?"s":""} ago`:s<24?`${s} hour${1!==s?"s":""} ago`:a<7?`${a} day${1!==a?"s":""} ago`:l<5?`${l} week${1!==l?"s":""} ago`:d<12?`${d} month${1!==d?"s":""} ago`:`${c} year${1!==c?"s":""} ago`:1===a?"1 day ago":a<7?`${a} days ago`:a<30?`${Math.floor(a/7)} weeks ago`:a<365?`${Math.floor(a/30)} months ago`:`${Math.floor(a/365)} years ago`}function n(e,t){if(!e||!e.startsWith("#"))return e;return`rgba(${parseInt(e.slice(1,3),16)}, ${parseInt(e.slice(3,5),16)}, ${parseInt(e.slice(5,7),16)}, ${t})`}const i=void 0!==e?e:function(){return""},r=void 0!==n?n:function(e,t){return e},o={};function s(){const e="promptreviews-single-widget-styles";if(document.getElementById(e))return;const t=document.createElement("link");let n;t.id=e,t.rel="stylesheet",t.type="text/css";const i=document.currentScript?document.currentScript.src:null;n=i?new URL("single-widget.css",i).href:"/widgets/single/single-widget.css",t.href=`${n}?v=${(new Date).getTime()}`,console.log("Attempting to load CSS from:",t.href),document.head.appendChild(t)}function a(e,t){const n=(e,n)=>t[e]||n,i=n("bgColor","#ffffff"),o=void 0!==t.bgOpacity?t.bgOpacity:1,s=o<1&&i.startsWith("#")?r(i,o):i,a=n("borderColor","#cccccc"),l=void 0!==t.borderOpacity?t.borderOpacity:1,d=l<1&&a.startsWith("#")?r(a,l):a;e.style.setProperty("--pr-card-bg",s),e.style.setProperty("--pr-text-color",n("textColor","#22223b")),e.style.setProperty("--pr-accent-color",n("accentColor","#4f46e5")),e.style.setProperty("--pr-name-text-color",n("nameTextColor","#1a237e")),e.style.setProperty("--pr-role-text-color",n("roleTextColor","#6b7280")),e.style.setProperty("--pr-card-border-width",`${t.borderWidth||2}px`),e.style.setProperty("--pr-card-border-color",d),e.style.setProperty("--pr-card-radius",`${t.borderRadius||16}px`),e.style.setProperty("--pr-card-opacity","1"),e.style.setProperty("--pr-font-family",t.font||"Inter, sans-serif"),e.style.setProperty("--pr-line-spacing",t.lineSpacing||1.4);let c=[];if(t.shadow){const e=t.shadowColor||"#000000",n=t.shadowIntensity||.2,i=e.startsWith("#")?r(e,n):`rgba(0, 0, 0, ${n})`;c.push(`0 4px 6px -1px ${i}`)}if(t.innerShadow){const e=t.innerShadowColor||"#FFFFFF",n=t.innerShadowOpacity||.5,i=e.startsWith("#")?r(e,n):`rgba(255, 255, 255, ${n})`;c.push(`inset 0 1px 3px ${i}`)}e.style.setProperty("--pr-card-shadow",c.length>0?c.join(", "):"none");const g=t.backdropBlur||10;e.style.setProperty("--pr-backdrop-blur",`${g}px`),e.style.setProperty("--pr-attribution-font-size",`${t.attributionFontSize||15}px`)}function l(e,t,n){console.log(`üöÄ single_initCarousel: Initializing for widgetId: "${e}"`);const i=document.getElementById(e);if(!i)return void console.error(`‚ùå single_initCarousel: FAILED to find element with ID: "${e}". The widget cannot be initialized.`);console.log("‚úÖ single_initCarousel: Found widgetElement:",i),function(e,t,n){o[e]={currentIndex:0,totalItems:t.length,itemsPerView:1,autoAdvance:n.autoAdvance||!1,slideshowSpeed:n.slideshowSpeed||4,autoAdvanceInterval:null}}(e,t,n);const r=o[e];if(!r)return void console.error(`‚ùå single_initCarousel: FAILED to initialize state for widgetId: "${e}"`);i.querySelector(".pr-single-carousel-track");const s=i.querySelector(".pr-single-prev-btn"),a=i.querySelector(".pr-single-next-btn");s&&s.addEventListener("click",()=>{r.currentIndex>0&&(r.currentIndex--,d(e))}),a&&a.addEventListener("click",()=>{r.currentIndex<r.totalItems-1&&(r.currentIndex++,d(e))}),r.autoAdvance&&r.totalItems>1&&(r.autoAdvanceInterval=setInterval(()=>{r.currentIndex<r.totalItems-1?r.currentIndex++:r.currentIndex=0,d(e)},1e3*r.slideshowSpeed)),d(e)}function d(e){const t=o[e];if(!t)return;const n=document.getElementById(e);if(!n)return;const i=n.querySelector(".pr-single-carousel-track");if(!i)return;t.itemsPerView=1;const r=n.querySelector(".pr-single-carousel-item");if(!r)return;const s=window.getComputedStyle(i).gap,a=parseFloat(s)||0,l=r.offsetWidth+a,c=-t.currentIndex*l;i.style.transform=`translateX(${c}px)`,function(e){const t=o[e];if(!t)return;const n=document.getElementById(e);if(!n)return;const i=n.querySelector(".pr-single-dots-container");if(!i)return;i.innerHTML="";for(let n=0;n<t.totalItems;n++){const r=document.createElement("button");r.className="pr-single-dot "+(n===t.currentIndex?"active":""),r.addEventListener("click",()=>{t.currentIndex=n,d(e)}),i.appendChild(r)}}(e),function(e){const t=o[e];if(!t)return;const n=document.getElementById(e);if(!n)return;const i=n.querySelector(".pr-single-prev-btn"),r=n.querySelector(".pr-single-next-btn");i&&(i.style.opacity=0===t.currentIndex?"0.5":"1",i.disabled=0===t.currentIndex);r&&(r.style.opacity=t.currentIndex===t.totalItems-1?"0.5":"1",r.disabled=t.currentIndex===t.totalItems-1)}(e)}function c(e,n){const i=e.review_content,r=n.showRelativeDate?(o=e.created_at,void 0!==t?t(o,!1):""):new Date(e.created_at).toLocaleDateString();var o;return`\n      <div class="pr-single-review-card">\n        <div class="pr-single-stars-row">${function(e){let t="";for(let n=1;n<=5;n++)t+=`<span class="pr-single-star ${n<=e?"filled":""}">&#9733;</span>`;return t}(e.star_rating)}</div>\n        <div class="pr-single-review-content">\n          <p class="pr-single-review-text">${i}</p>\n        </div>\n        <div class="pr-single-reviewer-details">\n          <div class="pr-single-reviewer-name">${e.first_name||""} ${e.last_name||""}</div>\n          ${e.reviewer_role?`<div class="pr-single-reviewer-role">${e.reviewer_role}</div>`:""}\n          <div class="pr-single-review-date">${r}</div>\n        </div>\n      </div>\n    `}function g(e,t,n,r,o){const s=t.map(e=>`<div class="pr-single-carousel-item">${c(e,n)}</div>`).join(""),a=`\n      <div class="pr-single-submit-review-container">\n        <a href="${o?`https://app.promptreviews.app/r/${r}?src=widget&wid=${o}&utm_medium=widget`:`https://app.promptreviews.app/r/${r}?src=widget&utm_medium=widget`}" target="_blank" class="pr-single-submit-btn">\n          Submit a Review\n        </a>\n      </div>\n    `;return`\n      ${i(t,null)}\n      <div class="pr-single-carousel-container">\n        <div class="pr-single-carousel-track">\n          ${s}\n        </div>\n      </div>\n      ${t.length>1?'\n      <div class="pr-single-carousel-controls">\n        <button class="pr-single-prev-btn" title="Previous review"></button>\n        <div class="pr-single-dots-container"></div>\n        <button class="pr-single-next-btn" title="Next review"></button>\n      </div>\n    ':""}\n      ${n.showSubmitReviewButton?a:""}\n    `}async function u(){if(window.location.pathname.includes("/dashboard"))return void console.log("üîÑ SingleWidget: Dashboard context detected, skipping auto-initialization");console.log("üöÄ AUTO INIT STARTED - Single Widget"),console.log("üîç Auto-initialization: Looking for widget containers...");const e=document.querySelectorAll("*"),t=Array.from(e).filter(e=>Object.keys(e.dataset).length>0);console.log("üîç All elements with data attributes:",t.length),t.forEach(e=>{console.log("üîç Element:",e.tagName,"data attributes:",Object.keys(e.dataset))});const n=document.querySelectorAll("[data-widget-id]"),i=Array.from(n).filter(e=>"single"===e.dataset.widgetType);if(console.log("üîç Auto-initialization: Found single widget containers:",i.length),i.length>0){console.log("üîç Auto-initialization: Processing containers..."),s();for(const e of i){const t=e.dataset.widgetId,n=e.getAttribute("data-business-slug");console.log("üîç Auto-initialization: Processing widget:",t,"business slug:",n);try{const n="app.promptreviews.app"===window.location.hostname?`/api/widgets/${t}`:`https://app.promptreviews.app/api/widgets/${t}`,i=await fetch(n);if(!i.ok)throw new Error(`Failed to fetch widget data: ${i.statusText}`);const{reviews:r,design:o,businessSlug:s}=await i.json();console.log("üîç Auto-initialization: Fetched data for widget:",t,"reviews:",r?.length),r&&r.length>0?(e.id=`pr-single-widget-${t}`,p(o.font),a(e,o),e.innerHTML=g(e.id,r,o,s,t),e.classList.add("pr-widget-container","pr-single-widget"),l(e.id,r,o),console.log("üîç Auto-initialization: Successfully initialized widget:",t)):(e.innerHTML='\n          <div style="display: flex; align-items: center; justify-content: center; min-height: 200px; color: white; font-size: 18px;">\n            <div style="text-align: center;">\n              <div style="display: flex; align-items: center; justify-content: center; gap: 8px; margin-bottom: 8px;">\n                <svg style="width: 24px; height: 24px;" fill="currentColor" viewBox="0 0 20 20">\n                  <path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd" />\n                </svg>\n                <span>Add reviews to your widget</span>\n              </div>\n              <p style="font-size: 14px; opacity: 0.8;">Click talk bubble icon to add and manage reviews.</p>\n            </div>\n          </div>\n        ',console.log("üîç Auto-initialization: No reviews for widget:",t))}catch(t){console.error("Error initializing PromptReviews Single widget:",t),e.innerHTML="<p>Error loading reviews.</p>"}}}else console.log("üîç Auto-initialization: No single widget containers found."),console.log("üîç Available data attributes on page:",t.map(e=>Object.keys(e.dataset)).flat())}function p(e){e&&"Inter"!==e||(e="Inter");const t=`google-font-${e.replace(/\s+/g,"-")}`;if(document.getElementById(t))return;const n=document.createElement("link");n.id=t,n.href=`https://fonts.googleapis.com/css2?family=${e.replace(/\s+/g,"+")}:wght@400;600;700&display=swap`,n.rel="stylesheet",document.head.appendChild(n)}window.PromptReviewsSingle=window.PromptReviewsSingle||{},window.PromptReviewsSingle.initializeWidget||(window.PromptReviewsSingle.initializeWidget=function(e,t,n,i,r){if(console.log("--- WIDGET INITIALIZATION - BUILD VERSION 5.0 ---"),console.log("üöÄ SingleWidget: Initializing widget",{containerId:e,reviewsCount:t?.length,design:n}),!t||0===t.length)return void console.warn("‚ö†Ô∏è SingleWidget: No reviews provided");const o=document.getElementById(e);if(!o)return void console.error("‚ùå SingleWidget: Widget container not found:",e);s(),p(n.font),a(o,n);const d=g(e,t,n,i,r);o.innerHTML=d,o.classList.add("pr-widget-container","pr-single-widget"),l(e,t,n),console.log("‚úÖ SingleWidget: Widget initialized successfully")}),window.PromptReviewsSingle.renderSingleWidget=function(e,t,n,i,r){window.PromptReviewsSingle.initializeWidget(e,t,n,i,r)},"loading"===document.readyState?document.addEventListener("DOMContentLoaded",u):u(),console.log("‚úÖ SingleWidget: Widget script loaded successfully")}();