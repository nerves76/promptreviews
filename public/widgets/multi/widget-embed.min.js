!function(){"use strict";function e(e,t){const o=t.bgColor||"#ffffff";let n=t.textColor||"#22223b";(function(e){if(!e||e.length<4)return!1;let t="#"===e.charAt(0)?e.substring(1):e;3===t.length&&(t=t.split("").map(e=>e+e).join(""));const o=parseInt(t.substring(0,2),16),n=parseInt(t.substring(2,4),16),i=parseInt(t.substring(4,6),16);return Math.sqrt(o*o*.299+n*n*.587+i*i*.114)<127.5})(o)&&(n="#ffffff");const i=t.nameTextColor||n,r=t.roleTextColor||n,s=t.accentColor||"#4f46e5",a=t.borderRadius||16,l=t.borderWidth||2,d=t.borderColor||"#cccccc",c=void 0!==t.bgOpacity?t.bgOpacity:1;let g=`\n      background-color: ${o};\n      color: ${n};\n      border-radius: ${a}px;\n      padding: 1.5rem;\n      display: flex;\n      flex-direction: column;\n      font-family: ${t.font||"Inter"}, sans-serif;\n      opacity: ${c};\n    `;if(t.border&&(g+=`border: ${l}px solid ${d};`),t.shadow){t.shadowColor;g+=`box-shadow: inset 0 0 20px rgba(0, 0, 0, ${t.shadowIntensity||.2});`}const p=t.showQuotes?`<span class="decorative-quote-opening" style="color: ${s}; font-size: 1.5rem; font-weight: bold; line-height: 1; opacity: 0.3; margin-bottom: 0.5rem; display: block; text-align: left; width: 100%;">"</span>`:"",u=t.showQuotes?`<span class="decorative-quote-closing" style="color: ${s}; font-size: 1.5rem; font-weight: bold; line-height: 1; opacity: 0.3; position: absolute; bottom: 1rem; right: 1rem;">"</span>`:"",w=e.star_rating?`<div class="stars-row" style="margin-bottom: 0.75rem; display: flex; justify-content: center;">${function(e){let t="";for(let o=1;o<=5;o++)t+=`<span class="star${o<=e?" filled":""}" style="color: ${o<=e?"#ffc107":"#e0e0e0"};">&#9733;</span>`;return t}(e.star_rating)}</div>`:"",f=t.showRelativeDate&&e.created_at?`<div class="reviewer-date" style="font-size: 0.875rem; color: ${r}; margin-top: 0.5rem;">${function(e){const t=new Date(e),o=new Date,n=Math.round((o-t)/1e3),i=Math.round(n/60),r=Math.round(i/60),s=Math.round(r/24),a=Math.round(s/7),l=Math.round(s/30.44),d=Math.round(s/365.25);return n<60?`${n} second${1!==n?"s":""} ago`:i<60?`${i} minute${1!==i?"s":""} ago`:r<24?`${r} hour${1!==r?"s":""} ago`:s<7?`${s} day${1!==s?"s":""} ago`:a<5?`${a} week${1!==a?"s":""} ago`:l<12?`${l} month${1!==l?"s":""} ago`:`${d} year${1!==d?"s":""} ago`}(e.created_at)}</div>`:"";return`\n      <div class="pr-review-card swiper-slide" style="${g}">\n        ${w}\n        <div class="review-content" style="flex-grow: 1; position: relative;">\n          ${p}\n          <p class="review-text" style="margin: 0; font-size: 1rem; line-height: 1.5; color: ${n}; padding-left: ${t.showQuotes?"1rem":"0"}; padding-right: ${t.showQuotes?"2rem":"0"}; padding-bottom: ${t.showQuotes?"2rem":"0"};">${e.review_content}</p>\n          ${u}\n        </div>\n        <div class="reviewer-details" style="margin-top: 1rem; text-align: center;">\n          <div class="reviewer-name" style="font-weight: bold; color: ${i};">${e.first_name||""} ${e.last_name||""}</div>\n          ${e.reviewer_role?`<div class="reviewer-role" style="font-size: 0.875rem; color: ${r};">${e.reviewer_role}</div>`:""}\n          ${f}\n        </div>\n      </div>\n    `}function t(t,o,n,i){console.log("üéØ Widget: initializeWidget called with:",{containerId:t,reviewsCount:o?.length,design:n,businessSlug:i});const r=document.getElementById(t);if(r){if(console.log("‚úÖ Widget: Container found:",r),!o||0===o.length)return console.log("‚ö†Ô∏è Widget: No reviews to display"),void(r.innerHTML='<div style="text-align: center; padding: 2rem;">No reviews to display.</div>');console.log("üé® Widget: Creating carousel HTML with",o.length,"reviews"),r.innerHTML=function(t,o,n,i){const r=o.map(t=>e(t,n)).join(""),s=n.bgColor||"#ffffff",a=n.borderRadius||16,l=n.borderWidth||2,d=n.borderColor||"#cccccc",c=n.textColor||"#22223b",g=n.accentColor||"#4f46e5";let p=`\n      display: inline-block;\n      background: ${s};\n      color: ${c};\n      padding: 8px 16px;\n      border: ${l}px solid ${d};\n      border-radius: ${a}px;\n      text-decoration: none;\n      font-weight: 500;\n      font-size: 0.9rem;\n      transition: all 0.3s ease;\n      margin-top: 1.5rem;\n    `;n.shadow&&(p+=`box-shadow: inset 0 0 10px rgba(0, 0, 0, ${.5*(n.shadowIntensity||.2)});`);return`\n      <div class="swiper-container pr-multi-widget-swiper" style="width: 100%; overflow: hidden;">\n        <div class="swiper-wrapper">\n          ${r}\n        </div>\n        \n      <div class="swiper-pagination" style="position: relative; bottom: auto; margin-top: 1.5rem;"></div>\n      <div class="swiper-button-prev" style="color: ${g};"></div>\n      <div class="swiper-button-next" style="color: ${g};"></div>\n    \n      </div>\n      ${n.showSubmitReviewButton?`<div class="pr-submit-review-container" style="text-align: right; margin-top: 1rem;"><a href="/r/${i}" target="_blank" class="pr-submit-btn" style="${p}">Submit a Review</a></div>`:""}\n    `}(0,o,n,i),console.log("‚úÖ Widget: Carousel HTML created, initializing swiper..."),function(e,t){new Swiper(`#${e} .pr-multi-widget-swiper`,{loop:t.autoAdvance||!1,slidesPerView:1,spaceBetween:16,pagination:{el:`#${e} .swiper-pagination`,clickable:!0},navigation:{nextEl:`#${e} .swiper-button-next`,prevEl:`#${e} .swiper-button-prev`},autoplay:!!t.autoAdvance&&{delay:1e3*(t.slideshowSpeed||4),disableOnInteraction:!0},breakpoints:{640:{slidesPerView:2,spaceBetween:20},1024:{slidesPerView:3,spaceBetween:30}}})}(t,n),console.log("‚úÖ Widget: Swiper carousel initialized successfully")}else console.error("‚ùå Widget: Container not found:",t)}function o(e){return new Promise((t,o)=>{if(document.querySelector(`script[src="${e}"]`))return void t();const n=document.createElement("script");n.src=e,n.onload=t,n.onerror=o,document.head.appendChild(n)})}async function n(){console.log("üîç Auto-initializing widgets...");const e=document.querySelectorAll("[data-widget-id]");if(console.log(`Found ${e.length} widgets to initialize`),0!==e.length){try{await Promise.all([(n="https://unpkg.com/swiper/swiper-bundle.min.css",new Promise((e,t)=>{if(document.querySelector(`link[href="${n}"]`))return void e();const o=document.createElement("link");o.rel="stylesheet",o.href=n,o.onload=e,o.onerror=t,document.head.appendChild(o)})),o("https://unpkg.com/swiper/swiper-bundle.min.js")]),console.log("‚úÖ Swiper assets loaded successfully.")}catch(e){console.error("‚ùå Failed to load Swiper assets. Widget may not function correctly.",e)}var n;e.forEach(e=>{const o=e.getAttribute("data-widget-id"),n=e.id||`promptreviews-widget-${o}`;e.id||(e.id=n),console.log(`üéØ Initializing widget: ${o} in container #${n}`),fetch(`/api/widgets/${o}`).then(e=>{if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return e.json()}).then(i=>{console.log(`‚úÖ Widget data loaded for ${o}:`,i),i.reviews&&i.design?t(n,i.reviews,i.design,i.businessSlug||"default"):(console.error(`‚ùå Invalid widget data for ${o}:`,i),e.innerHTML='<div style="text-align: center; padding: 2rem; color: #666;">Widget data not available.</div>')}).catch(t=>{console.error(`‚ùå Failed to load widget data for ${o}:`,t),e.innerHTML='<div style="text-align: center; padding: 2rem; color: #666;">Failed to load widget.</div>'})})}}window.PromptReviews=window.PromptReviews||{},window.PromptReviews.initializeWidget=t,"loading"===document.readyState?document.addEventListener("DOMContentLoaded",n):n(),console.log("‚úÖ PromptReviews Multi-Widget loaded")}();