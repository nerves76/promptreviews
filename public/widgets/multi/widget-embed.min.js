!function(){"use strict";function e(e,t){const o=t.bgColor||"#ffffff";let n=t.textColor||"#22223b";(function(e){if(!e||e.length<4)return!1;let t="#"===e.charAt(0)?e.substring(1):e;3===t.length&&(t=t.split("").map(e=>e+e).join(""));const o=parseInt(t.substring(0,2),16),n=parseInt(t.substring(2,4),16),i=parseInt(t.substring(4,6),16);return Math.sqrt(o*o*.299+n*n*.587+i*i*.114)<127.5})(o)&&(n="#ffffff");const i=t.nameTextColor||n,r=t.roleTextColor||n,s=t.accentColor||"#4f46e5",a=t.borderRadius||16,l=t.borderWidth||2,d=t.borderColor||"#cccccc",c=void 0!==t.bgOpacity?t.bgOpacity:1;let g=`\n      background-color: ${o};\n      color: ${n};\n      border-radius: ${a}px;\n      padding: 1.5rem;\n      display: flex;\n      flex-direction: column;\n      font-family: ${t.font||"Inter"}, sans-serif;\n      opacity: ${c};\n    `;if(t.border&&(g+=`border: ${l}px solid ${d};`),t.shadow){t.shadowColor;g+=`box-shadow: inset 0 0 20px rgba(0, 0, 0, ${t.shadowIntensity||.2});`}const u=t.showQuotes?`<span class="decorative-quote-opening" style="color: ${s}; font-size: 1.5rem; font-weight: bold; line-height: 1; opacity: 0.3; margin-bottom: 0.5rem; display: block; text-align: left; width: 100%;">"</span>`:"",p=t.showQuotes?`<span class="decorative-quote-closing" style="color: ${s}; font-size: 1.5rem; font-weight: bold; line-height: 1; opacity: 0.3; position: absolute; bottom: 1rem; right: 1rem;">"</span>`:"",f=e.star_rating?`<div class="stars-row" style="margin-bottom: 0.75rem; display: flex; justify-content: center;">${function(e){let t="";for(let o=1;o<=5;o++)t+=`<span class="star${o<=e?" filled":""}" style="color: ${o<=e?"#ffc107":"#e0e0e0"};">&#9733;</span>`;return t}(e.star_rating)}</div>`:"",w=t.showRelativeDate&&e.created_at?`<div class="reviewer-date" style="font-size: 0.875rem; color: ${r}; margin-top: 0.5rem;">${function(e){const t=new Date(e),o=new Date,n=Math.round((o-t)/1e3),i=Math.round(n/60),r=Math.round(i/60),s=Math.round(r/24),a=Math.round(s/7),l=Math.round(s/30.44),d=Math.round(s/365.25);return n<60?`${n} second${1!==n?"s":""} ago`:i<60?`${i} minute${1!==i?"s":""} ago`:r<24?`${r} hour${1!==r?"s":""} ago`:s<7?`${s} day${1!==s?"s":""} ago`:a<5?`${a} week${1!==a?"s":""} ago`:l<12?`${l} month${1!==l?"s":""} ago`:`${d} year${1!==d?"s":""} ago`}(e.created_at)}</div>`:"";return`\n      <div class="pr-review-card" style="${g}">\n        ${f}\n        <div class="review-content" style="flex-grow: 1; position: relative;">\n          ${u}\n          <p class="review-text" style="margin: 0; font-size: 1rem; line-height: 1.5; color: ${n}; padding-left: ${t.showQuotes?"1rem":"0"}; padding-right: ${t.showQuotes?"2rem":"0"}; padding-bottom: ${t.showQuotes?"2rem":"0"};">${e.review_content}</p>\n          ${p}\n        </div>\n        <div class="reviewer-details" style="margin-top: 1rem; text-align: center;">\n          <div class="reviewer-name" style="font-weight: bold; color: ${i};">${e.first_name||""} ${e.last_name||""}</div>\n          ${e.reviewer_role?`<div class="reviewer-role" style="font-size: 0.875rem; color: ${r};">${e.reviewer_role}</div>`:""}\n          ${w}\n        </div>\n      </div>\n    `}let t=0,o=3,n=0,i=[],r={};function s(){const e=document.querySelector(".pr-carousel-track");if(!e)return;const s=document.querySelector(".pr-carousel-container").offsetWidth;o=function(e){return Math.max(1,Math.floor(e/336))}(s),n=Math.ceil(i.length/o);const a=s/o*-t*o;e.style.transform=`translateX(${a}px)`,function(){const e=document.querySelectorAll(".pr-dot"),o=r.bgColor||"#ffffff",n=r.accentColor||"#4f46e5",i=void 0!==r.bgOpacity?r.bgOpacity:1;e.forEach((e,r)=>{const s=r===t;e.classList.toggle("active",s),s?(e.style.backgroundColor=o,e.style.opacity=i):(e.style.backgroundColor=n,e.style.opacity=.5*i)})}(),function(){const e=document.querySelector(".pr-prev-btn"),t=document.querySelector(".pr-next-btn");if(!e||!t)return;const o=r.bgColor||"#ffffff",n=r.borderWidth||2,i=r.borderColor||"#cccccc",s=r.accentColor||"#4f46e5",a=void 0!==r.bgOpacity?r.bgOpacity:1,l=`\n      background: ${o};\n      border: ${n}px solid ${i};\n      opacity: ${a};\n    `;e.style.cssText+=l,t.style.cssText+=l;const d=e.querySelector("div"),c=t.querySelector("div");d&&(d.style.borderRightColor=s);c&&(c.style.borderLeftColor=s);if(r.shadow){const o=`box-shadow: inset 0 0 20px rgba(0, 0, 0, ${r.shadowIntensity||.2});`;e.style.cssText+=o,t.style.cssText+=o}}()}function a(e){const o=Math.max(0,Math.min(e,n-1));o!==t&&(t=o,s())}function l(t,n,s){i=t,r=n;const a=t.map(t=>`<div class="pr-carousel-item">${e(t,n)}</div>`).join(""),l=Array.from({length:Math.ceil(t.length/o)},(e,t)=>`<button class="pr-dot" data-index="${t}" style="height: 12px; width: 12px; background-color: ${n.accentColor||"#4f46e5"}; border: none; border-radius: 50%; display: inline-block; transition: all 0.3s ease; cursor: pointer; padding: 0; margin: 0 8px; opacity: ${void 0!==n.bgOpacity?.5*n.bgOpacity:.5};"></button>`).join(""),d=n.bgColor||"#ffffff",c=n.borderRadius||16,g=n.borderWidth||2,u=n.borderColor||"#cccccc",p=n.textColor||"#22223b",f=n.accentColor||"#4f46e5",w=void 0!==n.bgOpacity?n.bgOpacity:1;let h=`\n      display: inline-block;\n      background: ${d};\n      color: ${p};\n      padding: 8px 16px;\n      border: ${g}px solid ${u};\n      border-radius: ${c}px;\n      text-decoration: none;\n      font-weight: 500;\n      font-size: 0.9rem;\n      transition: all 0.3s ease;\n      opacity: ${w};\n    `,b=`\n      cursor: pointer;\n      width: 40px;\n      height: 40px;\n      background: ${d};\n      border: ${g}px solid ${u};\n      border-radius: 50%;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      transition: all 0.2s ease;\n      position: relative;\n      opacity: ${w};\n    `;if(n.shadow){const e=n.shadowIntensity||.2;h+=`box-shadow: inset 0 0 20px rgba(0, 0, 0, ${e});`,b+=`box-shadow: inset 0 0 20px rgba(0, 0, 0, ${e});`}return`\n      <div class="pr-carousel-container" style="position: relative;">\n        <div class="pr-carousel-track" style="display: flex; transition: transform 0.5s ease;">\n          ${a}\n        </div>\n      </div>\n      <div class="pr-carousel-controls" style="text-align: center; margin-top: 1rem;">\n        <button class="pr-prev-btn" style="${b}">${`<div style="width: 0; height: 0; border-top: 6px solid transparent; border-bottom: 6px solid transparent; border-right: 8px solid ${f}; margin-left: 4px;"></div>`}</button>\n        <div class="pr-dots-container" style="display: inline-block; margin: 0 10px;">\n          ${l}\n        </div>\n        <button class="pr-next-btn" style="${b}">${`<div style="width: 0; height: 0; border-top: 6px solid transparent; border-bottom: 6px solid transparent; border-left: 8px solid ${f}; margin-right: 4px;"></div>`}</button>\n      </div>\n      ${n.showSubmitReviewButton?`<div class="pr-submit-review-container" style="text-align: right; margin-top: 0.5rem;"><a href="/r/${s}" target="_blank" class="pr-submit-btn" style="${h}">Submit a Review</a></div>`:""}\n    `}function d(){const e=document.querySelector(".pr-prev-btn"),o=document.querySelector(".pr-next-btn"),i=document.querySelector(".pr-dots-container");e&&e.addEventListener("click",()=>a(t-1)),o&&o.addEventListener("click",()=>a(t+1)),i&&i.addEventListener("click",e=>{e.target.matches(".pr-dot")&&a(parseInt(e.target.dataset.index,10))}),window.addEventListener("resize",s);let l=null;if(r.autoAdvance&&r.slideshowSpeed){const e=1e3*(r.slideshowSpeed||4);l=setInterval(()=>{a((t+1)%n)},e)}s(),window.addEventListener("beforeunload",()=>{l&&clearInterval(l)})}function c(e,t,o,n){console.log("üéØ Widget: initializeWidget called with:",{containerId:e,reviewsCount:t?.length,design:o,businessSlug:n});const i=document.getElementById(e);if(i){if(console.log("‚úÖ Widget: Container found:",i),!t||0===t.length)return console.log("‚ö†Ô∏è Widget: No reviews to display"),void(i.innerHTML='<div style="text-align: center; padding: 2rem;">No reviews to display.</div>');console.log("üé® Widget: Creating carousel HTML with",t.length,"reviews"),i.innerHTML=l(t,o,n),console.log("‚úÖ Widget: Carousel HTML created, initializing carousel..."),d(),console.log("‚úÖ Widget: Carousel initialized successfully")}else console.error("‚ùå Widget: Container not found:",e)}function g(){console.log("üîç Auto-initializing widgets...");const e=document.querySelectorAll("[data-widget-id]");console.log(`Found ${e.length} widgets to initialize`);(document.querySelector('link[href="/widgets/multi/multi-widget.css"]')?(console.log("‚úÖ CSS already loaded"),Promise.resolve()):(console.log("üì• Loading CSS from /widgets/multi/multi-widget.css..."),new Promise((e,t)=>{const o=document.createElement("link");o.rel="stylesheet",o.href="/widgets/multi/multi-widget.css",o.onload=()=>{console.log("‚úÖ CSS loaded successfully"),e()},o.onerror=e=>{console.error("‚ùå Failed to load CSS:",e),t(e)},document.head.appendChild(o)}))).then(()=>{e.forEach(e=>{const t=e.getAttribute("data-widget-id");console.log(`üéØ Initializing widget: ${t}`),fetch(`/api/widgets/${t}`).then(e=>{if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return e.json()}).then(o=>{console.log(`‚úÖ Widget data loaded for ${t}:`,o),o.reviews&&o.design?c(e.id,o.reviews,o.design,o.businessSlug||"default"):(console.error(`‚ùå Invalid widget data for ${t}:`,o),e.innerHTML='<div style="text-align: center; padding: 2rem; color: #666;">Widget data not available.</div>')}).catch(o=>{console.error(`‚ùå Failed to load widget data for ${t}:`,o),e.innerHTML='<div style="text-align: center; padding: 2rem; color: #666;">Failed to load widget.</div>'})})}).catch(t=>{console.error("‚ùå Failed to load CSS, widgets may not display correctly:",t),e.forEach(e=>{const t=e.getAttribute("data-widget-id");console.log(`üéØ Initializing widget without CSS: ${t}`),fetch(`/api/widgets/${t}`).then(e=>{if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return e.json()}).then(o=>{console.log(`‚úÖ Widget data loaded for ${t}:`,o),o.reviews&&o.design?c(e.id,o.reviews,o.design,o.businessSlug||"default"):(console.error(`‚ùå Invalid widget data for ${t}:`,o),e.innerHTML='<div style="text-align: center; padding: 2rem; color: #666;">Widget data not available.</div>')}).catch(o=>{console.error(`‚ùå Failed to load widget data for ${t}:`,o),e.innerHTML='<div style="text-align: center; padding: 2rem; color: #666;">Failed to load widget.</div>'})})})}window.PromptReviews=window.PromptReviews||{},window.PromptReviews.initializeWidget=c,window.PromptReviews.createCarouselHTML=l,window.PromptReviews.initializeCarousel=d,"loading"===document.readyState?document.addEventListener("DOMContentLoaded",g):g(),console.log("‚úÖ PromptReviews Multi-Widget loaded")}();