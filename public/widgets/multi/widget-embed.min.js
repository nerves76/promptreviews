!function(){"use strict";function e(e,t){const n=t.bgColor||"#ffffff";let r=t.textColor||"#22223b";(function(e){if(!e||e.length<4)return!1;let t="#"===e.charAt(0)?e.substring(1):e;3===t.length&&(t=t.split("").map(e=>e+e).join(""));const n=parseInt(t.substring(0,2),16),r=parseInt(t.substring(2,4),16),o=parseInt(t.substring(4,6),16);return Math.sqrt(n*n*.299+r*r*.587+o*o*.114)<127.5})(n)&&(r="#ffffff");const o=t.nameTextColor||r,i=t.roleTextColor||r,s=t.accentColor||"#4f46e5",a=t.borderRadius||16,c=t.borderWidth||2,d=t.borderColor||"#cccccc",l=void 0!==t.bgOpacity?t.bgOpacity:1;let u=`\n      background-color: ${n};\n      color: ${r};\n      border-radius: ${a}px;\n      padding: 1.5rem;\n      display: flex;\n      flex-direction: column;\n      font-family: ${t.font||"Inter"}, sans-serif;\n      opacity: ${l};\n    `;if(t.border&&(u+=`border: ${c}px solid ${d};`),t.shadow){t.shadowColor;u+=`box-shadow: inset 0 0 20px rgba(0, 0, 0, ${t.shadowIntensity||.2});`}const f=t.showQuotes?`<span class="decorative-quote-opening" style="color: ${s}; font-size: 1.5rem; font-weight: bold; line-height: 1; opacity: 0.3; margin-bottom: 0.5rem; display: block; text-align: left; width: 100%;">"</span>`:"",p=t.showQuotes?`<span class="decorative-quote-closing" style="color: ${s}; font-size: 1.5rem; font-weight: bold; line-height: 1; opacity: 0.3; position: absolute; bottom: 1rem; right: 1rem;">"</span>`:"",g=e.star_rating?`<div class="stars-row" style="margin-bottom: 0.75rem; display: flex; justify-content: center;">${function(e){let t="";for(let n=1;n<=5;n++)t+=`<span class="star${n<=e?" filled":""}" style="color: ${n<=e?"#ffc107":"#e0e0e0"};">&#9733;</span>`;return t}(e.star_rating)}</div>`:"",m=t.showRelativeDate&&e.created_at?`<div class="reviewer-date" style="font-size: 0.875rem; color: ${i}; margin-top: 0.5rem;">${function(e){const t=new Date(e),n=new Date,r=Math.round((n-t)/1e3),o=Math.round(r/60),i=Math.round(o/60),s=Math.round(i/24),a=Math.round(s/7),c=Math.round(s/30.44),d=Math.round(s/365.25);return r<60?`${r} second${1!==r?"s":""} ago`:o<60?`${o} minute${1!==o?"s":""} ago`:i<24?`${i} hour${1!==i?"s":""} ago`:s<7?`${s} day${1!==s?"s":""} ago`:a<5?`${a} week${1!==a?"s":""} ago`:c<12?`${c} month${1!==c?"s":""} ago`:`${d} year${1!==d?"s":""} ago`}(e.created_at)}</div>`:"";return`\n      <div class="pr-review-card" style="${u}">\n        ${g}\n        <div class="review-content" style="flex-grow: 1; position: relative;">\n          ${f}\n          <p class="review-text" style="margin: 0; font-size: 1rem; line-height: 1.5; color: ${r}; padding-left: ${t.showQuotes?"1rem":"0"}; padding-right: ${t.showQuotes?"2rem":"0"}; padding-bottom: ${t.showQuotes?"2rem":"0"};">${e.review_content}</p>\n          ${p}\n        </div>\n        <div class="reviewer-details" style="margin-top: 1rem; text-align: center;">\n          <div class="reviewer-name" style="font-weight: bold; color: ${o};">${e.first_name||""} ${e.last_name||""}</div>\n          ${e.reviewer_role?`<div class="reviewer-role" style="font-size: 0.875rem; color: ${i};">${e.reviewer_role}</div>`:""}\n          ${m}\n        </div>\n      </div>\n    `}let t={};function n(e){const n=t[e];if(!n)return;const o=document.getElementById(e);if(!o)return;const i=o.querySelector(".pr-carousel-track");if(!i)return;n.itemsPerView=function(e){const t=document.getElementById(e);if(!t)return 3;const n=t.querySelector(".pr-carousel-container"),r=t.querySelector(".pr-carousel-item");if(!n||!r||0===r.offsetWidth)return window.innerWidth<=640?1:window.innerWidth<=1024?2:3;const o=getComputedStyle(r.parentElement).gap,i=parseFloat(o)||16,s=n.offsetWidth,a=r.offsetWidth,c=Math.round((s+i)/(a+i));return Math.max(1,c)}(e);const s=-n.currentIndex*(100/n.itemsPerView);i.style.transform=`translateX(${s}%)`,function(e){const n=t[e],o=document.getElementById(e);if(!n||!o)return;const i=o.querySelector(".pr-dots-container");if(!i)return;const s=Math.ceil(n.reviews.length/n.itemsPerView);if(i.children.length!==s){let t="";for(let e=0;e<s;e++)t+=`<button class="pr-dot" data-index="${e}"></button>`;i.innerHTML=t,i.querySelectorAll(".pr-dot").forEach(t=>{t.addEventListener("click",t=>{const n=parseInt(t.target.dataset.index,10);r(e,n)})})}const a=i.querySelectorAll(".pr-dot"),c=n.currentIndex;a.forEach((e,t)=>{e.classList.toggle("active",t===c),e.style.backgroundColor=t===c?n.design.accentColor||"#4f46e5":"#cccccc"})}(e),function(e){const n=t[e],r=document.getElementById(e);if(!n||!r)return;const o=r.querySelector(".pr-prev-btn"),i=r.querySelector(".pr-next-btn");if(!o||!i)return;const s=Math.ceil(n.reviews.length/n.itemsPerView);o.disabled=0===n.currentIndex,i.disabled=n.currentIndex>=s-1}(e)}function r(e,r){const o=t[e];if(!o)return;const i=Math.ceil(o.reviews.length/o.itemsPerView),s=Math.max(0,Math.min(r,i-1));s!==o.currentIndex&&(o.currentIndex=s,n(e))}function o(n,r,o,i){!function(e,n,r){t[e]={currentIndex:0,itemsPerView:3,reviews:n,design:r,get totalPages(){return Math.ceil(this.reviews.length/this.itemsPerView)}}}(n,r,o);t[n];return`\n      <div class="pr-multi-widget">\n        <div class="pr-carousel-container">\n          <div class="pr-carousel-track">\n            ${r.map(t=>`<div class="pr-carousel-item">${e(t,o)}</div>`).join("")}\n          </div>\n        </div>\n        <div class="pr-carousel-controls">\n          <button class="pr-prev-btn">&lt;</button>\n          <div class="pr-dots-container"></div>\n          <button class="pr-next-btn">&gt;</button>\n        </div>\n        ${o.submitReviewsLink?`\n      <div class="pr-submit-review-container">\n        <a href="https://prompt.reviews/r/${i}" target="_blank" rel="noopener noreferrer" class="pr-submit-btn"\n           style="background-color: ${o.accentColor||"#4f46e5"}; color: #ffffff;">\n          Submit a Review\n        </a>\n      </div>\n    `:""}\n      </div>\n    `}function i(e){const o=document.getElementById(e);if(!o)return;const i=o.querySelector(".pr-prev-btn"),s=o.querySelector(".pr-next-btn");i.addEventListener("click",()=>{const n=t[e];r(e,n.currentIndex-1)}),s.addEventListener("click",()=>{const n=t[e];r(e,n.currentIndex+1)}),n(e),window.addEventListener("resize",()=>n(e))}async function s(){const e=document.querySelectorAll("[data-prompt-reviews-id], [data-widget-id]");if(0!==e.length){(()=>{const e="https://widgets.prompt.reviews/multi/multi-widget.css";if(document.querySelector(`link[href^="${e}"]`))return;const t=document.createElement("link");t.rel="stylesheet",t.href=`${e}?v=${(new Date).getTime()}`,document.head.appendChild(t)})();for(const t of e){const e=t.getAttribute("data-prompt-reviews-id")||t.getAttribute("data-widget-id"),n=t.getAttribute("data-business-slug");t.id=`pr-widget-container-${e}`;try{const r=await fetch(`http://localhost:3001/api/widgets/${e}`);if(!r.ok)throw new Error(`Failed to fetch widget data: ${r.statusText}`);const{reviews:s,design:a}=await r.json();s&&s.length>0?(t.innerHTML=o(t.id,s,a,n),i(t.id)):t.innerHTML="<p>No reviews to display.</p>"}catch(e){console.error("Error initializing PromptReviews widget:",e),t.innerHTML="<p>Error loading reviews.</p>"}}}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",s):s(),window.PromptReviews=window.PromptReviews||{},window.PromptReviews.initializeWidget=function(e,t,n,r){const s=document.getElementById(e);s?(s.setAttribute("data-prompt-reviews-id",e.replace("promptreviews-widget-container-","")),r&&s.setAttribute("data-business-slug",r),s.innerHTML=o(e,t,n,r),i(e)):console.error("Container not found:",e)}}();