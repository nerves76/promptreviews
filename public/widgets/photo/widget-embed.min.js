!function(){"use strict";const t={},e=new Set;function o(e,o,r){const i=t[e];if(!i)return;const a=document.getElementById(e),s=(a.querySelector(".pr-photo-carousel-track"),a.querySelector(".pr-photo-prev-btn")),d=a.querySelector(".pr-photo-next-btn");s&&s.addEventListener("click",()=>{i.currentIndex>0&&(i.currentIndex--,n(e))}),d&&d.addEventListener("click",()=>{i.currentIndex<i.totalItems-1&&(i.currentIndex++,n(e))}),i.autoAdvance&&i.totalItems>1&&(i.autoAdvanceInterval=setInterval(()=>{i.currentIndex<i.totalItems-1?i.currentIndex++:i.currentIndex=0,n(e)},1e3*i.slideshowSpeed)),n(e)}function n(o){if(e.has(o))return void console.log("üîÑ PhotoWidget: Skipping carousel update - widget is initializing:",o);const r=t[o];if(!r)return;const i=document.getElementById(o);if(!i)return void console.warn("‚ö†Ô∏è PhotoWidget: Widget element not found for ID:",o);const a=i.querySelector(".pr-photo-carousel-track");if(!a)return void console.warn("‚ö†Ô∏è PhotoWidget: Carousel track not found for widget:",o);r.itemsPerView=1;const s=i.querySelector(".pr-photo-carousel-item");if(!s)return void console.warn("‚ö†Ô∏è PhotoWidget: No carousel items found for widget:",o);const d=window.getComputedStyle(a).gap,c=parseFloat(d)||0,l=s.offsetWidth+c,p=-r.currentIndex*l;a.style.transform=`translateX(${p}px)`,function(e){const o=t[e];if(!o)return;const r=document.getElementById(e);if(!r)return void console.warn("‚ö†Ô∏è PhotoWidget: Widget element not found for dots update:",e);const i=r.querySelector(".pr-photo-dots-container");if(!i)return void console.warn("‚ö†Ô∏è PhotoWidget: Dots container not found for widget:",e);i.innerHTML="";for(let t=0;t<o.totalItems;t++){const r=document.createElement("button");r.className="pr-photo-dot "+(t===o.currentIndex?"active":""),r.style.backgroundColor=t===o.currentIndex?"#4f46e5":"#d1d5db",r.addEventListener("click",()=>{o.currentIndex=t,n(e)}),i.appendChild(r)}}(o),function(e){const o=t[e];if(!o)return;const n=document.getElementById(e);if(!n)return void console.warn("‚ö†Ô∏è PhotoWidget: Widget element not found for arrow buttons update:",e);const r=n.querySelector(".pr-photo-prev-btn"),i=n.querySelector(".pr-photo-next-btn");r&&(r.style.opacity=0===o.currentIndex?"0.5":"1",r.disabled=0===o.currentIndex);i&&(i.style.opacity=o.currentIndex===o.totalItems-1?"0.5":"1",i.disabled=o.currentIndex===o.totalItems-1)}(o)}function r(t,e){const o=e.showQuotes?`"${t.review_content}"`:t.review_content,n=e.showRelativeDate?function(t){const e=new Date(t),o=new Date,n=Math.abs(o-e),r=Math.ceil(n/864e5);return 1===r?"1 day ago":r<7?`${r} days ago`:r<30?`${Math.floor(r/7)} weeks ago`:r<365?`${Math.floor(r/30)} months ago`:`${Math.floor(r/365)} years ago`}(t.created_at):new Date(t.created_at).toLocaleDateString(),r=t.star_rating?function(t,e){const o=e.accentColor||"#4f46e5",n="#cccccc";let r="";for(let e=1;e<=5;e++)r+=e<=t?`<span style="color: ${o};">&#9733;</span>`:e-.5<=t?`<span style="position: relative; display: inline-block; color: ${n};">\n                            &#9733;\n                            <span style="position: absolute; left: 0; top: 0; width: 50%; overflow: hidden; color: ${o};">\n                                &#9733;\n                            </span>\n                        </span>`:`<span style="color: ${n};">&#9733;</span>`;return`<div class="pr-photo-stars-row" style="display: flex; justify-content: center; margin-bottom: 1rem;">${r}</div>`}(t.star_rating,e):"",i=t.photo_url&&""!==t.photo_url.trim();console.log("üîç PhotoWidget: Review photo check:",{reviewId:t.id,photoUrl:t.photo_url,hasPhoto:i,reviewData:t});const a=e.bgColor||"#ffffff",s=void 0!==e.bgOpacity?e.bgOpacity:1,d=(c=a,l=s,`rgba(${parseInt(c.slice(1,3),16)}, ${parseInt(c.slice(3,5),16)}, ${parseInt(c.slice(5,7),16)}, ${l})`);var c,l;const p=i?`\n      <div class="pr-photo-review-image" style="\n        width: 50%;\n        height: 100%;\n        position: absolute;\n        left: 0;\n        top: 0;\n        overflow: hidden;\n        border-top-left-radius: ${e.borderRadius||16}px;\n        border-bottom-left-radius: ${e.borderRadius||16}px;\n      ">\n        <img src="${t.photo_url}" alt="Review photo" style="\n          width: 100%;\n          height: 100%;\n          object-fit: cover;\n        " />\n      </div>\n    `:"";return`\n      <div class="pr-photo-review-card" style="\n        background-color: ${d};\n        border: ${e.borderWidth||2}px solid ${e.borderColor||"#cccccc"};\n        border-radius: ${e.borderRadius||16}px;\n        color: ${e.textColor||"#22223b"};\n        font-family: ${e.font||"Inter"}, sans-serif;\n        line-height: ${e.lineSpacing||1.4};\n        box-shadow: ${e.shadow?`0 4px 6px -1px rgba(0, 0, 0, ${e.shadowIntensity||.2})`:"none"};\n        padding: 0;\n        position: relative;\n        overflow: hidden;\n        min-height: 300px;\n      ">\n        ${i?p:""}\n        <div class="pr-photo-review-content" style="\n          display: flex;\n          height: 100%;\n          min-height: 300px;\n        ">\n          <div class="pr-photo-review-text-content" style="\n            flex: 1;\n            padding: 1.5rem;\n            ${i?"margin-left: 50%;":""}\n          ">\n            ${r}\n            <p class="pr-photo-review-text" style="margin-bottom: 1rem;">${o}</p>\n            <div class="pr-photo-reviewer-details">\n              <div style="\n                color: ${e.nameTextColor||"#1a237e"};\n                font-weight: 600;\n                margin-bottom: 0.25rem;\n              ">${t.first_name||""} ${t.last_name||""}</div>\n              ${t.reviewer_role?`<div style="\n                color: ${e.roleTextColor||"#6b7280"};\n                font-size: ${e.attributionFontSize||15}px;\n              ">${t.reviewer_role}</div>`:""}\n              <div style="\n                color: ${e.roleTextColor||"#6b7280"};\n                font-size: ${e.attributionFontSize||15}px;\n                margin-top: 0.25rem;\n              ">${n}</div>\n            </div>\n          </div>\n        </div>\n      </div>\n    `}function i(e,o,n,i){!function(e,o,n){t[e]={currentIndex:0,totalItems:o.length,itemsPerView:1,autoAdvance:n.autoAdvance||!1,slideshowSpeed:n.slideshowSpeed||4,autoAdvanceInterval:null}}(e,o,n);const a=t[e],s=o.map(t=>`<div class="pr-photo-carousel-item">${r(t,n)}</div>`).join(""),d=n.bgColor||"#ffffff",c=n.borderColor||"#cccccc",l=n.borderWidth||2,p=void 0!==n.bgOpacity?n.bgOpacity:1,u=n.accentColor||"#4f46e5",h=`\n      background-color: ${d};\n      border: ${l}px solid ${c};\n      opacity: ${p};\n    `,v=`\n      background-color: ${d};\n      border: ${l}px solid ${c};\n      border-radius: ${n.buttonBorderRadius||8}px;\n      opacity: ${p};\n      color: ${u};\n    `;return`\n      ${`\n      <style>\n        /* Arrow Color */\n        .pr-photo-prev-btn::before { border-color: transparent ${u} transparent transparent !important; }\n        .pr-photo-next-btn::before { border-color: transparent transparent transparent ${u} !important; }\n        \n        /* Arrow & Submit Button Hover: Invert colors */\n        .pr-photo-prev-btn:hover, .pr-photo-next-btn:hover, .pr-photo-submit-btn:hover {\n          background-color: ${u} !important;\n          color: ${d} !important;\n        }\n        \n        /* Arrow Icon Hover: Change to background color */\n        .pr-photo-prev-btn:hover::before { border-color: transparent ${d} transparent transparent !important; }\n        .pr-photo-next-btn:hover::before { border-color: transparent transparent transparent ${d} !important; }\n\n        /* Card Hover: Lift effect */\n        .pr-photo-review-card {\n          transition: transform 0.3s ease, box-shadow 0.3s ease;\n        }\n        .pr-photo-review-card:hover {\n          transform: ${n.liftOnHover?"translateY(-5px)":"none"};\n          box-shadow: ${n.liftOnHover?`0 10px 15px -3px rgba(0, 0, 0, ${n.shadowIntensity||.2})`:n.shadow?`0 4px 6px -1px rgba(0, 0, 0, ${n.shadowIntensity||.2})`:"none"};\n        }\n\n        /* Responsive design for photo widget */\n        @media (max-width: 768px) {\n          .pr-photo-review-content {\n            flex-direction: column !important;\n            height: auto !important;\n            min-height: auto !important;\n          }\n          .pr-photo-review-image {\n            width: 100% !important;\n            height: 200px !important;\n            position: relative !important;\n            border-radius: ${n.borderRadius||16}px ${n.borderRadius||16}px 0 0 !important;\n            margin-bottom: 0 !important;\n          }\n          .pr-photo-review-text-content {\n            margin-left: 0 !important;\n            padding: 1.5rem !important;\n          }\n        }\n      </style>\n    `}\n      <div class="pr-photo-carousel-container">\n        <div class="pr-photo-carousel-track">\n          ${s}\n        </div>\n      </div>\n      ${a.totalItems>1?`\n      <div class="pr-photo-carousel-controls">\n        <button class="pr-photo-prev-btn" style="${h}" title="Previous review"></button>\n        <div class="pr-photo-dots-container"></div>\n        <button class="pr-photo-next-btn" style="${h}" title="Next review"></button>\n      </div>\n    `:""}\n      ${n.showSubmitReviewButton?`\n      <div class="pr-photo-submit-review-container">\n        <a href="/r/${i}?source=widget" target="_blank" class="pr-photo-submit-btn" style="${v}">\n          Submit a Review\n        </a>\n      </div>\n    `:""}\n    `}async function a(){const t=document.querySelectorAll("[data-prompt-reviews-id], [data-widget-id]");if(0!==t.length)for(const e of t){const t=e.getAttribute("data-prompt-reviews-id")||e.getAttribute("data-widget-id"),n=e.getAttribute("data-business-slug");try{const r=await fetch(`http://localhost:3001/api/widgets/${t}`);if(!r.ok)throw new Error(`Failed to fetch widget data: ${r.statusText}`);const{reviews:a,design:s}=await r.json();a&&a.length>0?(e.innerHTML=i(e.id,a,s,n),o(e.id)):e.innerHTML="<p>No reviews to display.</p>"}catch(t){console.error("Error initializing PromptReviews Photo widget:",t),e.innerHTML="<p>Error loading reviews.</p>"}}}window.PromptReviewsPhoto=window.PromptReviewsPhoto||{},window.PromptReviewsPhoto.initializeWidget||(window.PromptReviewsPhoto.initializeWidget=function(t,n,r,a){if(console.log("üöÄ PhotoWidget: Initializing widget",{containerId:t,reviewsCount:n?.length,design:r}),!n||0===n.length)return void console.warn("‚ö†Ô∏è PhotoWidget: No reviews provided");const s=document.getElementById(t);if(!s)return void console.error("‚ùå PhotoWidget: Widget container not found:",t);e.add(t);const d=i(t,n,r,a);s.innerHTML=d,o(t,n,r),e.delete(t),console.log("‚úÖ PhotoWidget: Widget initialized successfully")}),window.PromptReviewsPhoto.renderPhotoWidget=function(t,e,o,n){window.PromptReviewsPhoto.initializeWidget(t,e,o,n)},"loading"===document.readyState?document.addEventListener("DOMContentLoaded",a):a(),console.log("‚úÖ PhotoWidget: Widget script loaded successfully")}();