!function(){"use strict";const n=new Set;let t={};window.PromptReviewsPhoto=window.PromptReviewsPhoto||{},window.PromptReviewsPhoto.initializeWidget||(window.PromptReviewsPhoto.initializeWidget=function(r,i,a,s){if(console.log("üöÄ PhotoWidget: Initializing widget",{containerId:r,reviewsCount:i?.length,design:a}),e(a),!i||0===i.length)return void console.warn("‚ö†Ô∏è PhotoWidget: No reviews provided");const d=document.getElementById(r);if(!d)return void console.error("‚ùå PhotoWidget: Widget container not found:",r);n.add(r);const p=function(n,e,o,r){!function(n,e,o){t[n]={currentIndex:0,totalItems:e.length,itemsPerView:1,autoAdvance:o.autoAdvance||!1,slideshowSpeed:o.slideshowSpeed||4,autoAdvanceInterval:null}}(n,e,o);const i=t[n],a=e.map(n=>`<div class="pr-photo-carousel-item">${function(n,t){const e=t.showQuotes?`"${n.review_content}"`:n.review_content,o=t.showRelativeDate?function(n){const t=new Date(n),e=new Date,o=Math.abs(e-t),r=Math.ceil(o/864e5);return 1===r?"1 day ago":r<7?`${r} days ago`:r<30?`${Math.floor(r/7)} weeks ago`:r<365?`${Math.floor(r/30)} months ago`:`${Math.floor(r/365)} years ago`}(n.created_at):new Date(n.created_at).toLocaleDateString(),r=n.star_rating?function(n,t){const e=t.accentColor||"#4f46e5",o="#cccccc";let r="";for(let t=1;t<=5;t++)r+=t<=n?`<span style="color: ${e};">&#9733;</span>`:t-.5<=n?`<span style="position: relative; display: inline-block; color: ${o};">\n                            &#9733;\n                            <span style="position: absolute; left: 0; top: 0; width: 50%; overflow: hidden; color: ${e};">\n                                &#9733;\n                            </span>\n                        </span>`:`<span style="color: ${o};">&#9733;</span>`;return`<div class="pr-photo-stars-row" style="display: flex; justify-content: center; margin-bottom: 1rem;">${r}</div>`}(n.star_rating,t):"",i=n.photo_url&&""!==n.photo_url.trim();console.log("üîç PhotoWidget: Review photo check:",{reviewId:n.id,photoUrl:n.photo_url,hasPhoto:i,reviewData:n});const a=t.bgColor||"#ffffff",s=void 0!==t.bgOpacity?t.bgOpacity:1,d=(l=a,c=s,`rgba(${parseInt(l.slice(1,3),16)}, ${parseInt(l.slice(3,5),16)}, ${parseInt(l.slice(5,7),16)}, ${c})`),p=i?`\n      <div class="pr-photo-review-image" style="\n        width: 50%;\n        height: 100%;\n        position: absolute;\n        left: 0;\n        top: 0;\n        overflow: hidden;\n        border-top-left-radius: ${t.borderRadius||16}px;\n        border-bottom-left-radius: ${t.borderRadius||16}px;\n      ">\n        <img src="${n.photo_url}" alt="Review photo" style="\n          width: 100%;\n          height: 100%;\n          object-fit: cover;\n        " />\n      </div>\n    `:"";var l,c;return`\n      <div class="pr-photo-review-card" style="\n        background-color: ${d};\n        border: ${t.borderWidth||2}px solid ${t.borderColor||"#cccccc"};\n        border-radius: ${t.borderRadius||16}px;\n        color: ${t.textColor||"#22223b"};\n        font-family: ${t.font||"Inter"}, sans-serif;\n        line-height: ${t.lineSpacing||1.4};\n        box-shadow: ${t.shadow?`0 4px 6px -1px rgba(0, 0, 0, ${t.shadowIntensity||.2})`:"none"};\n        padding: 0;\n        position: relative;\n        overflow: hidden;\n        min-height: 300px;\n      ">\n        ${i?p:""}\n        <div class="pr-photo-review-content" style="\n          display: flex;\n          height: 100%;\n          min-height: 300px;\n        ">\n          <div class="pr-photo-review-text-content" style="\n            flex: 1;\n            padding: 1.5rem;\n            ${i?"margin-left: 50%;":""}\n          ">\n            ${r}\n            <p class="pr-photo-review-text" style="margin-bottom: 1rem;">${e}</p>\n            <div class="pr-photo-reviewer-details">\n              <div style="\n                color: ${t.nameTextColor||"#1a237e"};\n                font-weight: 600;\n                margin-bottom: 0.25rem;\n              ">${n.first_name||""} ${n.last_name||""}</div>\n              ${n.reviewer_role?`<div style="\n                color: ${t.nameTextColor||"#1a237e"};\n                opacity: 0.65;\n                font-size: ${t.attributionFontSize||15}px;\n              ">${n.reviewer_role}</div>`:""}\n              <div style="\n                color: ${t.roleTextColor||"#6b7280"};\n                font-size: ${t.attributionFontSize||15}px;\n                margin-top: 0.25rem;\n              ">${o}</div>\n            </div>\n          </div>\n        </div>\n      </div>\n    `}(n,o)}</div>`).join(""),s='<div class="pr-photo-dots-container"></div>',d=o.bgColor||"#ffffff",p=o.borderColor||"#cccccc",l=o.borderWidth||2,c=void 0!==o.bgOpacity?o.bgOpacity:1,h=o.accentColor||"#4f46e5",u=`\n      background-color: ${d};\n      border: ${l}px solid ${p};\n      opacity: ${c};\n    `,g=`\n      background-color: ${d};\n      border: ${l}px solid ${p};\n      border-radius: ${o.buttonBorderRadius||8}px;\n      opacity: ${c};\n      color: ${h};\n    `,m=`\n      <style>\n        /* Arrow Color */\n        .pr-photo-prev-btn::before { border-color: transparent ${h} transparent transparent !important; }\n        .pr-photo-next-btn::before { border-color: transparent transparent transparent ${h} !important; }\n        \n        /* Arrow & Submit Button Hover: Invert colors */\n        .pr-photo-prev-btn:hover, .pr-photo-next-btn:hover, .pr-photo-submit-btn:hover {\n          background-color: ${h} !important;\n          color: ${d} !important;\n        }\n        \n        /* Arrow Icon Hover: Change to background color */\n        .pr-photo-prev-btn:hover::before { border-color: transparent ${d} transparent transparent !important; }\n        .pr-photo-next-btn:hover::before { border-color: transparent transparent transparent ${d} !important; }\n\n        /* Card Hover: Lift effect */\n        .pr-photo-review-card {\n          transition: transform 0.3s ease, box-shadow 0.3s ease;\n        }\n        .pr-photo-review-card:hover {\n          transform: ${o.liftOnHover?"translateY(-5px)":"none"};\n          box-shadow: ${o.liftOnHover?`0 10px 15px -3px rgba(0, 0, 0, ${o.shadowIntensity||.2})`:o.shadow?`0 4px 6px -1px rgba(0, 0, 0, ${o.shadowIntensity||.2})`:"none"};\n        }\n\n        /* Responsive design for photo widget */\n        @media (max-width: 768px) {\n          .pr-photo-review-content {\n            flex-direction: column !important;\n            height: auto !important;\n            min-height: auto !important;\n          }\n          .pr-photo-review-image {\n            width: 100% !important;\n            height: 200px !important;\n            position: relative !important;\n            border-radius: ${o.borderRadius||16}px ${o.borderRadius||16}px 0 0 !important;\n            margin-bottom: 0 !important;\n          }\n          .pr-photo-review-text-content {\n            margin-left: 0 !important;\n            padding: 1.5rem !important;\n          }\n        }\n      </style>\n    `,w=i.totalItems>1?`\n      <div class="pr-photo-carousel-controls">\n        <button class="pr-photo-prev-btn" style="${u}" title="Previous review"></button>\n        ${s}\n        <button class="pr-photo-next-btn" style="${u}" title="Next review"></button>\n      </div>\n    `:"",f=o.showSubmitReviewButton?`\n      <div class="pr-photo-submit-review-container">\n        <a href="/r/${r}?source=widget" target="_blank" class="pr-photo-submit-btn" style="${g}">\n          Submit a Review\n        </a>\n      </div>\n    `:"";return`\n      ${m}\n      <div class="pr-photo-carousel-container">\n        <div class="pr-photo-carousel-track">\n          ${a}\n        </div>\n      </div>\n      ${w}\n      ${f}\n    `}(r,i,a,s);d.innerHTML=p,d.classList.add("pr-photo-widget"),function(n){const e=t[n];if(!e)return;const r=document.getElementById(n),i=(r.querySelector(".pr-photo-carousel-track"),r.querySelector(".pr-photo-prev-btn")),a=r.querySelector(".pr-photo-next-btn");i&&i.addEventListener("click",()=>{e.currentIndex>0&&(e.currentIndex--,o(n))});a&&a.addEventListener("click",()=>{e.currentIndex<e.totalItems-1&&(e.currentIndex++,o(n))});e.autoAdvance&&e.totalItems>1&&(e.autoAdvanceInterval=setInterval(()=>{e.currentIndex<e.totalItems-1?e.currentIndex++:e.currentIndex=0,o(n)},1e3*e.slideshowSpeed));o(n)}(r),n.delete(r),console.log("‚úÖ PhotoWidget: Widget initialized successfully")});const e=n=>{const t="pr-photo-widget-styles";if(document.getElementById(t))return;const e=document.createElement("style");e.id=t,e.type="text/css",e.innerText='/* \n  Canonical CSS for the Photo-Widget.\n  This file is the single source of truth for styling the photo-widget,\n  used by both the dashboard preview and the live embeddable widget.\n*/\n\n/* \n  Container styles to mimic the dashboard preview environment.\n  This ensures the embedded widget has a consistent, centered,\n  and responsive container, just like in the app.\n*/\n#promptreviews-photo-widget {\n    position: relative;\n    width: 100%;\n    max-width: 64rem; /* 1024px */\n    margin-left: auto;\n    margin-right: auto;\n    font-size: 16px; /* Set a consistent base font size for rem calculations */\n}\n\n/* \n  Base widget container style.\n  This handles the sizing and centering of the widget itself,\n  both in the dashboard preview and on live sites.\n*/\n.pr-photo-widget {\n  all: revert;\n  box-sizing: border-box;\n  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";\n  \n  /* Sizing */\n  width: 100%;\n  max-width: 650px !important;\n  min-height: 300px !important;\n\n  /* Centering */\n  margin: auto; /* Centers horizontally and vertically within a flex container like the preview */\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n\n  /* Padding */\n  padding: 0 1rem;\n}\n  \n/* Carousel Layout */\n.pr-photo-carousel-container {\n    position: relative;\n    overflow: hidden;\n    width: 100%;\n    min-height: 300px; /* Ensure carousel has minimum height */\n}\n  \n.pr-photo-carousel-track {\n    display: flex;\n    transition: transform 0.5s ease;\n    gap: 0; /* No gap for photo widget */\n    min-height: 300px; /* Ensure track has minimum height */\n}\n  \n/* Single card takes full width */\n.pr-photo-carousel-item {\n    flex-shrink: 0;\n    width: 100%; /* Full width for single card */\n    display: flex; \n    min-height: 300px; /* Ensure item has minimum height */\n}\n  \n/* Review Card Styles */\n.pr-photo-widget .pr-photo-review-card {\n    background: var(--pr-card-bg, #fff);\n    border: var(--pr-card-border, 2px solid #cccccc);\n    border-radius: var(--pr-card-radius, 16px);\n    padding: 1.5rem;\n    display: flex;\n    flex-direction: column;\n    width: 100%;\n    text-align: center;\n    flex-grow: 1; \n    min-height: 300px; /* Ensure card has minimum height */\n}\n  \n.pr-photo-widget .pr-photo-review-content {\n    flex-grow: 1; /* Ensures the text content area grows, pushing footer down */\n}\n  \n.pr-photo-widget .pr-photo-reviewer-details {\n    margin-top: auto; /* Pushes details to the bottom of the card */\n}\n  \n/* --- Other existing styles below --- */\n  \n.pr-photo-widget .pr-photo-stars-row {\n    display: flex;\n    justify-content: center;\n}\n  \n.pr-photo-widget .pr-photo-review-text {\n    margin: 0;\n}\n  \n.pr-photo-carousel-controls {\n    text-align: center;\n    margin-top: 1.5rem;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    gap: 20px;\n}\n  \n.pr-photo-prev-btn,\n.pr-photo-next-btn {\n    cursor: pointer;\n    width: 40px;\n    height: 40px;\n    border-radius: 50%;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    transition: all 0.2s ease;\n    position: relative;\n}\n  \n.pr-photo-prev-btn::before,\n.pr-photo-next-btn::before {\n    content: \'\';\n    width: 0;\n    height: 0;\n    border-style: solid;\n}\n  \n.pr-photo-prev-btn::before {\n    border-width: 6px 8px 6px 0;\n    border-color: transparent #4f46e5 transparent transparent;\n    margin-left: -2px;\n}\n  \n.pr-photo-next-btn::before {\n    border-width: 6px 0 6px 8px;\n    border-color: transparent transparent transparent #4f46e5;\n    margin-right: -2px;\n}\n  \n.pr-photo-dots-container {\n    display: flex;\n    gap: 16px;\n    align-items: center;\n}\n  \n.pr-photo-dot {\n    height: 12px;\n    width: 12px;\n    border: none;\n    border-radius: 50%;\n    cursor: pointer;\n    padding: 0;\n    margin: 0;\n}\n  \n.pr-photo-submit-review-container {\n    text-align: right;\n    margin-top: 0.5rem;\n}\n  \n.pr-photo-submit-btn {\n    display: inline-block;\n    padding: 6px 12px;\n    text-decoration: none;\n    font-weight: 500;\n    font-size: 0.875rem;\n}\n  \n/* Responsive Design - simplified for single card */\n@media (max-width: 640px) {\n    .pr-photo-carousel-track {\n      gap: 0;\n    }\n    .pr-photo-submit-review-container {\n      margin-top: 1.5rem;\n    }\n} ',document.head.appendChild(e)};function o(e){if(n.has(e))return void console.log("üîÑ PhotoWidget: Skipping carousel update - widget is initializing:",e);const r=t[e];if(!r)return;const i=document.getElementById(e);if(!i)return void console.warn("‚ö†Ô∏è PhotoWidget: Widget element not found for ID:",e);const a=i.querySelector(".pr-photo-carousel-track");if(!a)return void console.warn("‚ö†Ô∏è PhotoWidget: Carousel track not found for widget:",e);r.itemsPerView=1;const s=i.querySelector(".pr-photo-carousel-item");if(!s)return void console.warn("‚ö†Ô∏è PhotoWidget: No carousel items found for widget:",e);const d=window.getComputedStyle(a).gap,p=parseFloat(d)||0,l=s.offsetWidth+p,c=-r.currentIndex*l;a.style.transform=`translateX(${c}px)`,function(n){const e=t[n];if(!e)return;const r=document.getElementById(n);if(!r)return void console.warn("‚ö†Ô∏è PhotoWidget: Widget element not found for dots update:",n);const i=r.querySelector(".pr-photo-dots-container");if(!i)return void console.warn("‚ö†Ô∏è PhotoWidget: Dots container not found for widget:",n);i.innerHTML="";for(let t=0;t<e.totalItems;t++){const r=document.createElement("button");r.className="pr-photo-dot "+(t===e.currentIndex?"active":""),r.style.backgroundColor=t===e.currentIndex?"#4f46e5":"#d1d5db",r.addEventListener("click",()=>{e.currentIndex=t,o(n)}),i.appendChild(r)}}(e),function(n){const e=t[n];if(!e)return;const o=document.getElementById(n);if(!o)return void console.warn("‚ö†Ô∏è PhotoWidget: Widget element not found for arrow buttons update:",n);const r=o.querySelector(".pr-photo-prev-btn"),i=o.querySelector(".pr-photo-next-btn");r&&(r.style.opacity=0===e.currentIndex?"0.5":"1",r.disabled=0===e.currentIndex);i&&(i.style.opacity=e.currentIndex===e.totalItems-1?"0.5":"1",i.disabled=e.currentIndex===e.totalItems-1)}(e)}async function r(){const n=document.querySelectorAll("[data-prompt-reviews-id], [data-widget-id]");if(0!==n.length)for(const t of n){const n=t.getAttribute("data-prompt-reviews-id")||t.getAttribute("data-widget-id"),e=t.getAttribute("data-business-slug");try{const o=await fetch(`http://localhost:3001/api/widgets/${n}`);if(!o.ok)throw new Error(`Failed to fetch widget data: ${o.statusText}`);const{reviews:r,design:i}=await o.json();r&&r.length>0?window.PromptReviewsPhoto.initializeWidget(t.id,r,i,e):t.innerHTML="<p>No reviews to display.</p>"}catch(n){console.error("Error initializing PromptReviews Photo widget:",n),t.innerHTML="<p>Error loading reviews.</p>"}}}window.PromptReviewsPhoto.renderPhotoWidget=function(n,t,e,o){window.PromptReviewsPhoto.initializeWidget(n,t,e,o)},"loading"===document.readyState?document.addEventListener("DOMContentLoaded",r):r(),console.log("‚úÖ PhotoWidget: Widget script loaded successfully")}();