!function(){"use strict";const t=new Set;let e={};window.PromptReviewsPhoto=window.PromptReviewsPhoto||{},window.PromptReviewsPhoto.initializeWidget||(window.PromptReviewsPhoto.initializeWidget=function(r,i,a,s){if(console.log("üöÄ PhotoWidget: Initializing widget",{containerId:r,reviewsCount:i?.length,design:a}),n(a),!i||0===i.length)return void console.warn("‚ö†Ô∏è PhotoWidget: No reviews provided");const d=document.getElementById(r);if(!d)return void console.error("‚ùå PhotoWidget: Widget container not found:",r);t.add(r);const l=function(t,n,o,r){!function(t,n,o){e[t]={currentIndex:0,totalItems:n.length,itemsPerView:1,autoAdvance:o.autoAdvance||!1,slideshowSpeed:o.slideshowSpeed||4,autoAdvanceInterval:null}}(t,n,o);const i=e[t],a=n.map(t=>`<div class="pr-photo-carousel-item">${function(t,e){const n=e.showQuotes?`&#8220;${t.review_content}&#8221;`:t.review_content,o=e.showRelativeDate?function(t){const e=new Date(t),n=new Date,o=Math.abs(n-e),r=Math.ceil(o/864e5);return 1===r?"1 day ago":r<7?`${r} days ago`:r<30?`${Math.floor(r/7)} weeks ago`:r<365?`${Math.floor(r/30)} months ago`:`${Math.floor(r/365)} years ago`}(t.created_at):new Date(t.created_at).toLocaleDateString(),r=e.showPlatform&&t.platform?` via ${t.platform}`:"",i=t.star_rating?function(t,e){const n=e.accentColor||"#4f46e5",o="#cccccc";let r="";for(let e=1;e<=5;e++)r+=e<=t?`<span style="color: ${n};">&#9733;</span>`:e-.5<=t?`<span style="position: relative; display: inline-block; color: ${o};">\n                            &#9733;\n                            <span style="position: absolute; left: 0; top: 0; width: 50%; overflow: hidden; color: ${n};">\n                                &#9733;\n                            </span>\n                        </span>`:`<span style="color: ${o};">&#9733;</span>`;return`<div class="pr-photo-stars-row" style="display: flex; justify-content: center; margin-bottom: 1rem;">${r}</div>`}(t.star_rating,e):"",a=t.photo_url&&""!==t.photo_url.trim();console.log("üîç PhotoWidget: Review photo check:",{reviewId:t.id,photoUrl:t.photo_url,hasPhoto:a,reviewData:t});const s=e.bgColor||"#ffffff",d=void 0!==e.bgOpacity?e.bgOpacity:1,l=(p=s,u=d,`rgba(${parseInt(p.slice(1,3),16)}, ${parseInt(p.slice(3,5),16)}, ${parseInt(p.slice(5,7),16)}, ${u})`),c=a?`\n      <div class="pr-photo-review-image" style="\n        width: 50%;\n        height: 100%;\n        position: absolute;\n        left: 0;\n        top: 0;\n        overflow: hidden;\n        border-top-left-radius: ${e.borderRadius||16}px;\n        border-bottom-left-radius: ${e.borderRadius||16}px;\n      ">\n        <img src="${t.photo_url}" alt="Review photo" style="\n          width: 100%;\n          height: 100%;\n          object-fit: cover;\n        " />\n      </div>\n    `:"";var p,u;return`\n      <div class="pr-photo-review-card" style="\n        background-color: ${l};\n        ${e.border?`border: ${e.borderWidth||2}px solid ${e.borderColor||"#cccccc"};`:"border: none;"}\n        border-radius: ${e.borderRadius||16}px;\n        color: ${e.textColor||"#22223b"};\n        font-family: ${e.font||"Inter"}, sans-serif;\n        line-height: ${e.lineSpacing||1.4};\n        box-shadow: ${e.shadow?`0 4px 6px -1px rgba(0, 0, 0, ${e.shadowIntensity||.2})`:"none"};\n        padding: 0;\n        position: relative;\n        overflow: hidden;\n        min-height: 300px;\n      ">\n        ${a?c:""}\n        <div class="pr-photo-review-content" style="\n          display: flex;\n          height: 100%;\n          min-height: 300px;\n        ">\n          <div class="pr-photo-review-text-content" style="\n            flex: 1;\n            padding: 1.5rem;\n            ${a?"margin-left: 50%;":""}\n          ">\n            ${i}\n            <p class="pr-photo-review-text" style="margin-bottom: 1rem;">${n}</p>\n            <div class="pr-photo-reviewer-details">\n              <div style="\n                color: ${e.nameTextColor||"#1a237e"};\n                font-weight: 600;\n                margin-bottom: 0.25rem;\n              ">${t.first_name||""} ${t.last_name||""}</div>\n              ${t.reviewer_role?`<div style="\n                color: ${e.nameTextColor||"#1a237e"};\n                opacity: 0.65;\n                font-size: ${e.attributionFontSize||15}px;\n              ">${t.reviewer_role}</div>`:""}\n              <div style="\n                color: ${e.roleTextColor||"#6b7280"};\n                font-size: ${e.attributionFontSize||15}px;\n                margin-top: 0.125rem;\n              ">${o}${r}</div>\n            </div>\n          </div>\n        </div>\n      </div>\n    `}(t,o)}</div>`).join(""),s='<div class="pr-photo-dots-container"></div>',d=o.bgColor||"#ffffff",l=o.borderColor||"#cccccc",c=o.borderWidth||2,p=void 0!==o.bgOpacity?o.bgOpacity:1,u=o.accentColor||"#4f46e5",h=`\n      background-color: ${d};\n      border: ${c}px solid ${l};\n      opacity: ${p};\n    `,g=`\n      background-color: ${d};\n      border: ${c}px solid ${l};\n      border-radius: ${o.buttonBorderRadius||8}px;\n      opacity: ${p};\n      color: ${u};\n    `,v=`\n      <style>\n        /* Arrow Color */\n        .pr-photo-prev-btn::before { border-color: transparent ${u} transparent transparent !important; }\n        .pr-photo-next-btn::before { border-color: transparent transparent transparent ${u} !important; }\n        \n        /* Arrow & Submit Button Hover: Invert colors */\n        .pr-photo-prev-btn:hover, .pr-photo-next-btn:hover, .pr-photo-submit-btn:hover {\n          background-color: ${u} !important;\n          color: ${d} !important;\n        }\n        \n        /* Arrow Icon Hover: Change to background color */\n        .pr-photo-prev-btn:hover::before { border-color: transparent ${d} transparent transparent !important; }\n        .pr-photo-next-btn:hover::before { border-color: transparent transparent transparent ${d} !important; }\n\n        /* Card Hover: Lift effect */\n        .pr-photo-review-card {\n          transition: transform 0.3s ease, box-shadow 0.3s ease;\n        }\n        .pr-photo-review-card:hover {\n          transform: ${o.liftOnHover?"translateY(-5px)":"none"};\n          box-shadow: ${o.liftOnHover?`0 10px 15px -3px rgba(0, 0, 0, ${o.shadowIntensity||.2})`:o.shadow?`0 4px 6px -1px rgba(0, 0, 0, ${o.shadowIntensity||.2})`:"none"};\n        }\n\n        /* Responsive design for photo widget */\n        @media (max-width: 768px) {\n          .pr-photo-review-content {\n            flex-direction: column !important;\n            height: auto !important;\n            min-height: auto !important;\n          }\n          .pr-photo-review-image {\n            width: 100% !important;\n            height: 200px !important;\n            position: relative !important;\n            border-radius: ${o.borderRadius||16}px ${o.borderRadius||16}px 0 0 !important;\n            margin-bottom: 0 !important;\n          }\n          .pr-photo-review-text-content {\n            margin-left: 0 !important;\n            padding: 1.5rem !important;\n          }\n        }\n      </style>\n    `,w=i.totalItems>1?`\n      <div class="pr-photo-carousel-controls">\n        <button class="pr-photo-prev-btn" style="${h}" title="Previous review"></button>\n        ${s}\n        <button class="pr-photo-next-btn" style="${h}" title="Next review"></button>\n      </div>\n    `:"",m=o.showSubmitReviewButton?`\n      <div class="pr-photo-submit-review-container">\n        <a href="https://promptreviews.app/r/${r}?source=widget" target="_blank" class="pr-photo-submit-btn" style="${g}">\n          Submit a Review\n        </a>\n      </div>\n    `:"",f=function(t,e){if(!t||0===t.length)return"";const n=t.reduce((t,e)=>t+(e.star_rating||0),0),o=(n/t.length).toFixed(1),r=t.length,i={"@context":"https://schema.org","@type":"Product",name:e||document.title||"Business",aggregateRating:{"@type":"AggregateRating",ratingValue:o,bestRating:"5",worstRating:"1",ratingCount:r,reviewCount:r},review:t.slice(0,5).map(t=>({"@type":"Review",reviewRating:{"@type":"Rating",ratingValue:t.star_rating||5,bestRating:"5",worstRating:"1"},author:{"@type":"Person",name:`${t.first_name||""} ${t.last_name||""}`.trim()||"Anonymous"},datePublished:t.created_at,reviewBody:t.review_content}))};return`<script type="application/ld+json">${JSON.stringify(i)}<\/script>`}(n,null);return`\n      ${f}\n      ${v}\n      <div class="pr-photo-carousel-container">\n        <div class="pr-photo-carousel-track">\n          ${a}\n        </div>\n      </div>\n      ${w}\n      ${m}\n    `}(r,i,a,s);d.innerHTML=l,d.classList.add("pr-photo-widget"),function(t){const n=e[t];if(!n)return;const r=document.getElementById(t),i=(r.querySelector(".pr-photo-carousel-track"),r.querySelector(".pr-photo-prev-btn")),a=r.querySelector(".pr-photo-next-btn");i&&i.addEventListener("click",()=>{n.currentIndex>0&&(n.currentIndex--,o(t))});a&&a.addEventListener("click",()=>{n.currentIndex<n.totalItems-1&&(n.currentIndex++,o(t))});n.autoAdvance&&n.totalItems>1&&(n.autoAdvanceInterval=setInterval(()=>{n.currentIndex<n.totalItems-1?n.currentIndex++:n.currentIndex=0,o(t)},1e3*n.slideshowSpeed));o(t)}(r),t.delete(r),console.log("‚úÖ PhotoWidget: Widget initialized successfully")});const n=t=>{const e="pr-photo-widget-styles";if(document.getElementById(e))return;const n=document.createElement("style");n.id=e,n.type="text/css",n.innerText="__INJECT_CSS_CONTENT__",document.head.appendChild(n)};function o(n){if(t.has(n))return void console.log("üîÑ PhotoWidget: Skipping carousel update - widget is initializing:",n);const r=e[n];if(!r)return;const i=document.getElementById(n);if(!i)return void console.warn("‚ö†Ô∏è PhotoWidget: Widget element not found for ID:",n);const a=i.querySelector(".pr-photo-carousel-track");if(!a)return void console.warn("‚ö†Ô∏è PhotoWidget: Carousel track not found for widget:",n);r.itemsPerView=1;const s=i.querySelector(".pr-photo-carousel-item");if(!s)return void console.warn("‚ö†Ô∏è PhotoWidget: No carousel items found for widget:",n);const d=window.getComputedStyle(a).gap,l=parseFloat(d)||0,c=s.offsetWidth+l,p=-r.currentIndex*c;a.style.transform=`translateX(${p}px)`,function(t){const n=e[t];if(!n)return;const r=document.getElementById(t);if(!r)return void console.warn("‚ö†Ô∏è PhotoWidget: Widget element not found for dots update:",t);const i=r.querySelector(".pr-photo-dots-container");if(!i)return void console.warn("‚ö†Ô∏è PhotoWidget: Dots container not found for widget:",t);i.innerHTML="";for(let e=0;e<n.totalItems;e++){const r=document.createElement("button");r.className="pr-photo-dot "+(e===n.currentIndex?"active":""),r.style.backgroundColor=e===n.currentIndex?"#4f46e5":"#d1d5db",r.addEventListener("click",()=>{n.currentIndex=e,o(t)}),i.appendChild(r)}}(n),function(t){const n=e[t];if(!n)return;const o=document.getElementById(t);if(!o)return void console.warn("‚ö†Ô∏è PhotoWidget: Widget element not found for arrow buttons update:",t);const r=o.querySelector(".pr-photo-prev-btn"),i=o.querySelector(".pr-photo-next-btn");r&&(r.style.opacity=0===n.currentIndex?"0.5":"1",r.disabled=0===n.currentIndex);i&&(i.style.opacity=n.currentIndex===n.totalItems-1?"0.5":"1",i.disabled=n.currentIndex===n.totalItems-1)}(n)}async function r(){if(window.location.pathname.includes("/dashboard"))return void console.log("üîÑ PhotoWidget: Dashboard context detected, skipping auto-initialization");const t=document.querySelectorAll("[data-prompt-reviews-id], [data-widget-id]");if(0!==t.length){n();for(const e of t){const t=e.getAttribute("data-prompt-reviews-id")||e.getAttribute("data-widget-id"),n=e.getAttribute("data-business-slug");e.id=`pr-widget-container-${t}`;try{const o="app.promptreviews.app"===window.location.hostname?`/api/widgets/${t}`:`https://app.promptreviews.app/api/widgets/${t}`,r=await fetch(o);if(!r.ok)throw new Error(`Failed to fetch widget data: ${r.statusText}`);const{reviews:i,design:a}=await r.json();i&&i.length>0?window.PromptReviewsPhoto.initializeWidget(e.id,i,a,n):e.innerHTML='\n        <div style="display: flex; align-items: center; justify-content: center; min-height: 200px; color: white; font-size: 18px;">\n          <div style="text-align: center;">\n            <div style="display: flex; align-items: center; justify-content: center; gap: 8px; margin-bottom: 8px;">\n              <svg style="width: 24px; height: 24px;" fill="currentColor" viewBox="0 0 20 20">\n                <path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd" />\n              </svg>\n              <span>Add reviews to your widget</span>\n            </div>\n            <p style="font-size: 14px; opacity: 0.8;">Click talk bubble icon to add and manage reviews.</p>\n          </div>\n        </div>\n      '}catch(t){console.error("Error initializing PromptReviews widget:",t),e.innerHTML="<p>Error loading reviews.</p>"}}}}window.PromptReviewsPhoto.renderPhotoWidget=function(t,e,n,o){window.PromptReviewsPhoto.initializeWidget(t,e,n,o)},"loading"===document.readyState?document.addEventListener("DOMContentLoaded",r):r(),console.log("‚úÖ PhotoWidget: Widget script loaded successfully")}();