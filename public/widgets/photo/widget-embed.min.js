!function(){"use strict";const t=new Set;let e={};window.PromptReviewsPhoto=window.PromptReviewsPhoto||{},window.PromptReviewsPhoto.initializeWidget||(window.PromptReviewsPhoto.initializeWidget=function(r,i,a,d){if(console.log("üöÄ PhotoWidget: Initializing widget",{containerId:r,reviewsCount:i?.length,design:a}),o(a),!i||0===i.length)return void console.warn("‚ö†Ô∏è PhotoWidget: No reviews provided");const s=document.getElementById(r);if(!s)return void console.error("‚ùå PhotoWidget: Widget container not found:",r);t.add(r);const c=function(t,o,n,r){!function(t,o,n){e[t]={currentIndex:0,totalItems:o.length,itemsPerView:1,autoAdvance:n.autoAdvance||!1,slideshowSpeed:n.slideshowSpeed||4,autoAdvanceInterval:null}}(t,o,n);const i=e[t],a=o.map(t=>`<div class="pr-photo-carousel-item">${function(t,e){const o=e.showQuotes?`&#8220;${t.review_content}&#8221;`:t.review_content,n=e.showRelativeDate?function(t){const e=new Date(t),o=new Date,n=Math.abs(o-e),r=Math.ceil(n/864e5);return 1===r?"1 day ago":r<7?`${r} days ago`:r<30?`${Math.floor(r/7)} weeks ago`:r<365?`${Math.floor(r/30)} months ago`:`${Math.floor(r/365)} years ago`}(t.created_at):new Date(t.created_at).toLocaleDateString(),r=t.star_rating?function(t,e){const o=e.accentColor||"#4f46e5",n="#cccccc";let r="";for(let e=1;e<=5;e++)r+=e<=t?`<span style="color: ${o};">&#9733;</span>`:e-.5<=t?`<span style="position: relative; display: inline-block; color: ${n};">\n                            &#9733;\n                            <span style="position: absolute; left: 0; top: 0; width: 50%; overflow: hidden; color: ${o};">\n                                &#9733;\n                            </span>\n                        </span>`:`<span style="color: ${n};">&#9733;</span>`;return`<div class="pr-photo-stars-row" style="display: flex; justify-content: center; margin-bottom: 1rem;">${r}</div>`}(t.star_rating,e):"",i=t.photo_url&&""!==t.photo_url.trim();console.log("üîç PhotoWidget: Review photo check:",{reviewId:t.id,photoUrl:t.photo_url,hasPhoto:i,reviewData:t});const a=e.bgColor||"#ffffff",d=void 0!==e.bgOpacity?e.bgOpacity:1,s=(l=a,p=d,`rgba(${parseInt(l.slice(1,3),16)}, ${parseInt(l.slice(3,5),16)}, ${parseInt(l.slice(5,7),16)}, ${p})`),c=i?`\n      <div class="pr-photo-review-image" style="\n        width: 50%;\n        height: 100%;\n        position: absolute;\n        left: 0;\n        top: 0;\n        overflow: hidden;\n        border-top-left-radius: ${e.borderRadius||16}px;\n        border-bottom-left-radius: ${e.borderRadius||16}px;\n      ">\n        <img src="${t.photo_url}" alt="Review photo" style="\n          width: 100%;\n          height: 100%;\n          object-fit: cover;\n        " />\n      </div>\n    `:"";var l,p;return`\n      <div class="pr-photo-review-card" style="\n        background-color: ${s};\n        ${e.border?`border: ${e.borderWidth||2}px solid ${e.borderColor||"#cccccc"};`:"border: none;"}\n        border-radius: ${e.borderRadius||16}px;\n        color: ${e.textColor||"#22223b"};\n        font-family: ${e.font||"Inter"}, sans-serif;\n        line-height: ${e.lineSpacing||1.4};\n        box-shadow: ${e.shadow?`0 4px 6px -1px rgba(0, 0, 0, ${e.shadowIntensity||.2})`:"none"};\n        padding: 0;\n        position: relative;\n        overflow: hidden;\n        min-height: 300px;\n      ">\n        ${i?c:""}\n        <div class="pr-photo-review-content" style="\n          display: flex;\n          height: 100%;\n          min-height: 300px;\n        ">\n          <div class="pr-photo-review-text-content" style="\n            flex: 1;\n            padding: 1.5rem;\n            ${i?"margin-left: 50%;":""}\n          ">\n            ${r}\n            <p class="pr-photo-review-text" style="margin-bottom: 1rem;">${o}</p>\n            <div class="pr-photo-reviewer-details">\n              <div style="\n                color: ${e.nameTextColor||"#1a237e"};\n                font-weight: 600;\n                margin-bottom: 0.25rem;\n              ">${t.first_name||""} ${t.last_name||""}</div>\n              ${t.reviewer_role?`<div style="\n                color: ${e.nameTextColor||"#1a237e"};\n                opacity: 0.65;\n                font-size: ${e.attributionFontSize||15}px;\n              ">${t.reviewer_role}</div>`:""}\n              <div style="\n                color: ${e.roleTextColor||"#6b7280"};\n                font-size: ${e.attributionFontSize||15}px;\n                margin-top: 0.25rem;\n              ">${n}</div>\n            </div>\n          </div>\n        </div>\n      </div>\n    `}(t,n)}</div>`).join(""),d='<div class="pr-photo-dots-container"></div>',s=n.bgColor||"#ffffff",c=n.borderColor||"#cccccc",l=n.borderWidth||2,p=void 0!==n.bgOpacity?n.bgOpacity:1,u=n.accentColor||"#4f46e5",h=`\n      background-color: ${s};\n      border: ${l}px solid ${c};\n      opacity: ${p};\n    `,v=`\n      background-color: ${s};\n      border: ${l}px solid ${c};\n      border-radius: ${n.buttonBorderRadius||8}px;\n      opacity: ${p};\n      color: ${u};\n    `,g=`\n      <style>\n        /* Arrow Color */\n        .pr-photo-prev-btn::before { border-color: transparent ${u} transparent transparent !important; }\n        .pr-photo-next-btn::before { border-color: transparent transparent transparent ${u} !important; }\n        \n        /* Arrow & Submit Button Hover: Invert colors */\n        .pr-photo-prev-btn:hover, .pr-photo-next-btn:hover, .pr-photo-submit-btn:hover {\n          background-color: ${u} !important;\n          color: ${s} !important;\n        }\n        \n        /* Arrow Icon Hover: Change to background color */\n        .pr-photo-prev-btn:hover::before { border-color: transparent ${s} transparent transparent !important; }\n        .pr-photo-next-btn:hover::before { border-color: transparent transparent transparent ${s} !important; }\n\n        /* Card Hover: Lift effect */\n        .pr-photo-review-card {\n          transition: transform 0.3s ease, box-shadow 0.3s ease;\n        }\n        .pr-photo-review-card:hover {\n          transform: ${n.liftOnHover?"translateY(-5px)":"none"};\n          box-shadow: ${n.liftOnHover?`0 10px 15px -3px rgba(0, 0, 0, ${n.shadowIntensity||.2})`:n.shadow?`0 4px 6px -1px rgba(0, 0, 0, ${n.shadowIntensity||.2})`:"none"};\n        }\n\n        /* Responsive design for photo widget */\n        @media (max-width: 768px) {\n          .pr-photo-review-content {\n            flex-direction: column !important;\n            height: auto !important;\n            min-height: auto !important;\n          }\n          .pr-photo-review-image {\n            width: 100% !important;\n            height: 200px !important;\n            position: relative !important;\n            border-radius: ${n.borderRadius||16}px ${n.borderRadius||16}px 0 0 !important;\n            margin-bottom: 0 !important;\n          }\n          .pr-photo-review-text-content {\n            margin-left: 0 !important;\n            padding: 1.5rem !important;\n          }\n        }\n      </style>\n    `,w=i.totalItems>1?`\n      <div class="pr-photo-carousel-controls">\n        <button class="pr-photo-prev-btn" style="${h}" title="Previous review"></button>\n        ${d}\n        <button class="pr-photo-next-btn" style="${h}" title="Next review"></button>\n      </div>\n    `:"",m=n.showSubmitReviewButton?`\n      <div class="pr-photo-submit-review-container">\n        <a href="/r/${r}?source=widget" target="_blank" class="pr-photo-submit-btn" style="${v}">\n          Submit a Review\n        </a>\n      </div>\n    `:"";return`\n      ${g}\n      <div class="pr-photo-carousel-container">\n        <div class="pr-photo-carousel-track">\n          ${a}\n        </div>\n      </div>\n      ${w}\n      ${m}\n    `}(r,i,a,d);s.innerHTML=c,s.classList.add("pr-photo-widget"),function(t){const o=e[t];if(!o)return;const r=document.getElementById(t),i=(r.querySelector(".pr-photo-carousel-track"),r.querySelector(".pr-photo-prev-btn")),a=r.querySelector(".pr-photo-next-btn");i&&i.addEventListener("click",()=>{o.currentIndex>0&&(o.currentIndex--,n(t))});a&&a.addEventListener("click",()=>{o.currentIndex<o.totalItems-1&&(o.currentIndex++,n(t))});o.autoAdvance&&o.totalItems>1&&(o.autoAdvanceInterval=setInterval(()=>{o.currentIndex<o.totalItems-1?o.currentIndex++:o.currentIndex=0,n(t)},1e3*o.slideshowSpeed));n(t)}(r),t.delete(r),console.log("‚úÖ PhotoWidget: Widget initialized successfully")});const o=t=>{const e="pr-photo-widget-styles";if(document.getElementById(e))return;const o=document.createElement("style");o.id=e,o.type="text/css",o.innerText="__INJECT_CSS_CONTENT__",document.head.appendChild(o)};function n(o){if(t.has(o))return void console.log("üîÑ PhotoWidget: Skipping carousel update - widget is initializing:",o);const r=e[o];if(!r)return;const i=document.getElementById(o);if(!i)return void console.warn("‚ö†Ô∏è PhotoWidget: Widget element not found for ID:",o);const a=i.querySelector(".pr-photo-carousel-track");if(!a)return void console.warn("‚ö†Ô∏è PhotoWidget: Carousel track not found for widget:",o);r.itemsPerView=1;const d=i.querySelector(".pr-photo-carousel-item");if(!d)return void console.warn("‚ö†Ô∏è PhotoWidget: No carousel items found for widget:",o);const s=window.getComputedStyle(a).gap,c=parseFloat(s)||0,l=d.offsetWidth+c,p=-r.currentIndex*l;a.style.transform=`translateX(${p}px)`,function(t){const o=e[t];if(!o)return;const r=document.getElementById(t);if(!r)return void console.warn("‚ö†Ô∏è PhotoWidget: Widget element not found for dots update:",t);const i=r.querySelector(".pr-photo-dots-container");if(!i)return void console.warn("‚ö†Ô∏è PhotoWidget: Dots container not found for widget:",t);i.innerHTML="";for(let e=0;e<o.totalItems;e++){const r=document.createElement("button");r.className="pr-photo-dot "+(e===o.currentIndex?"active":""),r.style.backgroundColor=e===o.currentIndex?"#4f46e5":"#d1d5db",r.addEventListener("click",()=>{o.currentIndex=e,n(t)}),i.appendChild(r)}}(o),function(t){const o=e[t];if(!o)return;const n=document.getElementById(t);if(!n)return void console.warn("‚ö†Ô∏è PhotoWidget: Widget element not found for arrow buttons update:",t);const r=n.querySelector(".pr-photo-prev-btn"),i=n.querySelector(".pr-photo-next-btn");r&&(r.style.opacity=0===o.currentIndex?"0.5":"1",r.disabled=0===o.currentIndex);i&&(i.style.opacity=o.currentIndex===o.totalItems-1?"0.5":"1",i.disabled=o.currentIndex===o.totalItems-1)}(o)}async function r(){if(window.location.pathname.includes("/dashboard"))return void console.log("üîÑ PhotoWidget: Dashboard context detected, skipping auto-initialization");const t=document.querySelectorAll("[data-prompt-reviews-id], [data-widget-id]");if(0!==t.length){o();for(const e of t){const t=e.getAttribute("data-prompt-reviews-id")||e.getAttribute("data-widget-id"),o=e.getAttribute("data-business-slug");e.id=`pr-widget-container-${t}`;try{const n="app.promptreviews.app"===window.location.hostname?`/api/widgets/${t}`:`https://app.promptreviews.app/api/widgets/${t}`,r=await fetch(n);if(!r.ok)throw new Error(`Failed to fetch widget data: ${r.statusText}`);const{reviews:i,design:a}=await r.json();i&&i.length>0?window.PromptReviewsPhoto.initializeWidget(e.id,i,a,o):e.innerHTML='\n        <div style="display: flex; align-items: center; justify-content: center; min-height: 200px; color: white; font-size: 18px;">\n          <div style="text-align: center;">\n            <div style="display: flex; align-items: center; justify-content: center; gap: 8px; margin-bottom: 8px;">\n              <svg style="width: 24px; height: 24px;" fill="currentColor" viewBox="0 0 20 20">\n                <path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd" />\n              </svg>\n              <span>Add reviews to your widget</span>\n            </div>\n            <p style="font-size: 14px; opacity: 0.8;">Click talk bubble icon to add and manage reviews.</p>\n          </div>\n        </div>\n      '}catch(t){console.error("Error initializing PromptReviews widget:",t),e.innerHTML="<p>Error loading reviews.</p>"}}}}window.PromptReviewsPhoto.renderPhotoWidget=function(t,e,o,n){window.PromptReviewsPhoto.initializeWidget(t,e,o,n)},"loading"===document.readyState?document.addEventListener("DOMContentLoaded",r):r(),console.log("‚úÖ PhotoWidget: Widget script loaded successfully")}();